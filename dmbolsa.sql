-- MySQL dump 10.13  Distrib 8.0.19, for Win64 (x86_64)
--
-- Host: localhost    Database: dmbolsa
-- ------------------------------------------------------
-- Server version	8.0.40

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `bt_catalogo`
--

DROP TABLE IF EXISTS `bt_catalogo`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_catalogo` (
  `NCATA_ID` int NOT NULL,
  `CCATA_NOMBRE` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `CCATA_DESCRIPCION` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `NAUDI_USR_INS` int NOT NULL,
  `DAUDI_USR_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `NAUDI_USR_UPD` int DEFAULT NULL,
  `DAUDI_USR_UPD` datetime DEFAULT NULL,
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1',
  `NCATA_ESTADO` int NOT NULL DEFAULT '1',
  PRIMARY KEY (`NCATA_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_catalogo`
--

LOCK TABLES `bt_catalogo` WRITE;
/*!40000 ALTER TABLE `bt_catalogo` DISABLE KEYS */;
INSERT INTO `bt_catalogo` VALUES (10,'TIPO DE DOCUMENTO','TIPO DE DOCUMENTO DE IDENTIFICACIÓN',1,'2025-02-26 14:24:06',NULL,NULL,1,1),(11,'SEXO','SEXO DE LA PERSONA',1,'2025-02-26 14:24:23',NULL,NULL,1,1),(12,'ESTADO REGISTRO','ESTADO DEL REGISTRO',1,'2025-02-26 14:24:48',NULL,NULL,1,1),(13,'TIPO DE PREGUNTA','TIPO DE PREGUNTA',1,'2025-02-27 12:21:13',NULL,NULL,1,1),(14,'PAÍSES','LISTA DE PAÍSES',1,'2025-02-27 14:20:11',NULL,NULL,1,1),(15,'ESTADO CIVIL','LISTA DE ESTADO CIVIL',1,'2025-02-27 14:29:08',NULL,NULL,1,1),(16,'NIVEL DE EDUCACIÓN','LISTA DE NIVELES DE EDUCACIÓN',1,'2025-02-27 14:35:54',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_catalogo` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_catalogo_detalle`
--

DROP TABLE IF EXISTS `bt_catalogo_detalle`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_catalogo_detalle` (
  `NCADE_ID` int NOT NULL,
  `NCADE_ID_ORIGEN` int DEFAULT NULL,
  `NCATA_ID` int NOT NULL,
  `CCADE_CODIGO` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `CCADE_NOMBRE` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `CCADE_DESCRIPCION` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `CCADE_ABREVIATURA` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `NCADE_ORDENAMIENTO` int DEFAULT NULL,
  `NAUDI_USR_INS` int NOT NULL,
  `DAUDI_USR_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `NAUDI_USR_UPD` int DEFAULT NULL,
  `DAUDI_USR_UPD` datetime DEFAULT NULL,
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1',
  `NCADE_ESTADO` int NOT NULL DEFAULT '1',
  PRIMARY KEY (`NCADE_ID`),
  KEY `FK1_CATALOGO_DETALLE` (`NCATA_ID`) USING BTREE,
  CONSTRAINT `frm_catalogo_detalle_frm_catalogo_FK` FOREIGN KEY (`NCATA_ID`) REFERENCES `bt_catalogo` (`NCATA_ID`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_catalogo_detalle`
--

LOCK TABLES `bt_catalogo_detalle` WRITE;
/*!40000 ALTER TABLE `bt_catalogo_detalle` DISABLE KEYS */;
INSERT INTO `bt_catalogo_detalle` VALUES (10000001,NULL,10,'1','DNI','TIPO DE DOCUMENTO PERSONAL','DNI',1,1,'2025-02-26 14:28:22',NULL,NULL,1,1),(10000002,NULL,10,'2','CARNE DE EXTRANJERÍA','TIPO DE DOCUMENTO PERSONAL','CE',2,1,'2025-02-26 14:28:22',NULL,NULL,1,1),(10000003,NULL,10,'3','PASAPORTE','TIPO DE DOCUMENTO PERSONAL','PAS',3,1,'2025-02-26 14:28:22',NULL,NULL,1,1),(11000001,NULL,11,'1','MASCULINO','GÉNERO DE LA PERSONA','M',1,1,'2025-02-26 14:28:22',NULL,NULL,1,1),(11000002,NULL,11,'2','FEMENINO','GÉNERO DE LA PERSONA','F',2,1,'2025-02-26 14:28:22',NULL,NULL,1,1),(12000001,NULL,12,'1','ACTIVO','ESTADO DEL REGISTRO','ACT',1,1,'2025-02-26 14:25:55',NULL,NULL,1,1),(12000002,NULL,12,'0','INACTIVO','ESTADO DEL REGISTRO','INA',2,1,'2025-02-26 14:26:24',NULL,NULL,1,1),(13000001,NULL,13,'1','SELECT','TIPO DE PREGUNTA','SEL',1,1,'2025-02-27 12:22:07',NULL,NULL,1,1),(13000002,NULL,13,'2','INPUT','TIPO DE PREGUNTA','INP',2,1,'2025-02-27 12:22:35',NULL,NULL,1,1),(13000003,NULL,13,'3','RADIO','TIPO DE PREGUNTA','RAD',3,1,'2025-02-27 12:22:57',NULL,NULL,1,1),(13000004,NULL,13,'4','INPUT FILE','TIPO DE PREGUNTA','FILE',4,1,'2025-02-27 12:23:21',NULL,NULL,1,1),(13000005,NULL,13,'5','TEXT AREA','TIPO DE PREGUNTA','LTEXT',5,1,'2025-02-27 12:24:00',NULL,NULL,1,1),(13000006,NULL,13,'6','CHECKBOX','TIPO DE PREGUNTA','CHK',6,1,'2025-02-27 14:44:59',NULL,NULL,1,1),(14000001,NULL,14,'1','PERÚ','LISTA DE PAÍSES','PER',1,1,'2025-02-27 14:20:53',NULL,NULL,1,1),(14000002,NULL,14,'2','ARGENTINA','LISTA DE PAÍSES','ARG',2,1,'2025-02-27 14:22:18',NULL,NULL,1,1),(14000003,NULL,14,'3','BOLIVIA','LISTA DE PAÍSES','BOL',3,1,'2025-02-27 14:22:56',NULL,NULL,1,1),(15000001,NULL,15,'1','SOLTERO(A)','ESTADO CIVIL','SOL',1,1,'2025-02-27 14:29:16',NULL,NULL,1,1),(15000002,NULL,15,'2','CASADO(A)','ESTADO CIVIL','CAS',2,1,'2025-02-27 14:29:40',NULL,NULL,1,1),(15000003,NULL,15,'3','CONVIVIENTE','ESTADO CIVIL','CON',3,1,'2025-02-27 14:30:03',NULL,NULL,1,1),(15000004,NULL,15,'4','DIVORCIADO(A)','ESTADO CIVIL','DIV',4,1,'2025-02-27 14:30:32',NULL,NULL,1,1),(15000005,NULL,15,'5','VIUDO(A)','ESTADO CIVIL','VIU',5,1,'2025-02-27 14:30:56',NULL,NULL,1,1),(16000001,NULL,16,'1','EDUCACIÓN BÁSICA REGULAR (EBR) - INICIAL','NIVEL DE EDUCACIÓN','BAS',1,1,'2025-02-27 14:36:41',NULL,NULL,1,1),(16000002,NULL,16,'2','EDUCACIÓN BÁSICA REGULAR (EBR) - PRIMARIA','NIVEL DE EDUCACIÓN','PRIM',2,1,'2025-02-27 14:40:17',NULL,NULL,1,1),(16000003,NULL,16,'3','EDUCACIÓN BÁSICA REGULAR (EBR) - SECUNDARIA','NIVEL DE EDUCACIÓN','SEC',3,1,'2025-02-27 14:40:17',NULL,NULL,1,1),(16000004,NULL,16,'4','EDUCACIÓN BÁSICA ESPECIAL (EBA) ','NIVEL DE EDUCACIÓN','ESP',4,1,'2025-02-27 14:40:17',NULL,NULL,1,1),(16000005,NULL,16,'5','EDUCACIÓN SUPEIOR TÉCNICA','NIVEL DE EDUCACIÓN','TEC',5,1,'2025-02-27 14:40:17',NULL,NULL,1,1),(16000006,NULL,16,'6','EDUCACIÓN SUPEIOR UNIVERSITARIA','NIVEL DE EDUCACIÓN','UNI',6,1,'2025-02-27 14:40:17',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_catalogo_detalle` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_departamento`
--

DROP TABLE IF EXISTS `bt_departamento`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_departamento` (
  `NDEPA_ID` int NOT NULL AUTO_INCREMENT,
  `CDEPA_NOMBRE` varchar(150) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `NAUDI_REG_INS` int NOT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NDEPA_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`NDEPA_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_departamento`
--

LOCK TABLES `bt_departamento` WRITE;
/*!40000 ALTER TABLE `bt_departamento` DISABLE KEYS */;
INSERT INTO `bt_departamento` VALUES (1,'LIMA',1,'2025-03-12 12:15:36',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_departamento` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_distrito`
--

DROP TABLE IF EXISTS `bt_distrito`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_distrito` (
  `NDIST_ID` int NOT NULL AUTO_INCREMENT,
  `CDIST_NOMBRE` varchar(150) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `NDEPA_ID` int DEFAULT NULL,
  `NAUDI_REG_INS` int NOT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NDIST_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`NDIST_ID`),
  KEY `bt_distrito_bt_departamento_fk` (`NDEPA_ID`),
  CONSTRAINT `bt_distrito_bt_departamento_fk` FOREIGN KEY (`NDEPA_ID`) REFERENCES `bt_departamento` (`NDEPA_ID`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_distrito`
--

LOCK TABLES `bt_distrito` WRITE;
/*!40000 ALTER TABLE `bt_distrito` DISABLE KEYS */;
INSERT INTO `bt_distrito` VALUES (1,'LIMA',1,1,'2025-03-12 12:15:57',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_distrito` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_eventos`
--

DROP TABLE IF EXISTS `bt_eventos`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_eventos` (
  `NEVEN_ID` int NOT NULL AUTO_INCREMENT,
  `CEVEN_NOMBRE` varchar(100) NOT NULL,
  `NAUDI_USR_INS` int NOT NULL,
  `DAUDI_USR_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `NAUDI_USR_UPD` int DEFAULT NULL,
  `DAUDI_USR_UPD` datetime DEFAULT NULL,
  `NEVEN_ESTADO` int NOT NULL DEFAULT '1',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1',
  PRIMARY KEY (`NEVEN_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_eventos`
--

LOCK TABLES `bt_eventos` WRITE;
/*!40000 ALTER TABLE `bt_eventos` DISABLE KEYS */;
INSERT INTO `bt_eventos` VALUES (1,'MAESTRÍA DE DOCENTES CONTRATADOS',1,'2025-02-26 16:32:21',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_eventos` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_formularios`
--

DROP TABLE IF EXISTS `bt_formularios`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_formularios` (
  `NFORM_ID` int NOT NULL AUTO_INCREMENT,
  `NEVEN_ID` int NOT NULL,
  `CFORM_IMAGEN` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `CFORM_TITULO` varchar(150) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `CFORM_SUBTITULO` mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci,
  `CFORM_LINK` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `NAUDI_USR_INS` int NOT NULL,
  `DAUDI_USR_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `NAUDI_USR_UPD` int DEFAULT NULL,
  `DAUDI_USR_UPD` datetime DEFAULT NULL,
  `NFORM_ESTADO` int NOT NULL DEFAULT '1',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1',
  PRIMARY KEY (`NFORM_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_formularios`
--

LOCK TABLES `bt_formularios` WRITE;
/*!40000 ALTER TABLE `bt_formularios` DISABLE KEYS */;
INSERT INTO `bt_formularios` VALUES (1,1,'cover.jpg','En convenio con la Derrama Magisterial y la Universidad Pedagógica Nacional de Argentina','INGRESES SUS DATOS 2','1234',1,'2025-02-26 16:33:37',NULL,NULL,1,1),(2,1,'cover.jpg','Ejemplo','Hola','123',1,'2025-02-28 15:35:28',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_formularios` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_formularios_respuesta`
--

DROP TABLE IF EXISTS `bt_formularios_respuesta`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_formularios_respuesta` (
  `NFORES_ID` int NOT NULL AUTO_INCREMENT,
  `NFORM_ID` int NOT NULL,
  `CFORES_LINK` varchar(150) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `NFORES_ESTADO_ENVIO` int NOT NULL DEFAULT '0',
  `NAUDI_USR_INS` int DEFAULT NULL,
  `DAUDI_USR_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `NAUDI_USR_UPD` int DEFAULT NULL,
  `DAUDI_USR_UPD` datetime DEFAULT NULL,
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1',
  `NFORES_ESTADO` int NOT NULL DEFAULT '1',
  PRIMARY KEY (`NFORES_ID`),
  KEY `frm_formularios_respuesta_frm_formularios_FK` (`NFORM_ID`),
  CONSTRAINT `frm_formularios_respuesta_frm_formularios_FK` FOREIGN KEY (`NFORM_ID`) REFERENCES `bt_formularios` (`NFORM_ID`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=55 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_formularios_respuesta`
--

LOCK TABLES `bt_formularios_respuesta` WRITE;
/*!40000 ALTER TABLE `bt_formularios_respuesta` DISABLE KEYS */;
INSERT INTO `bt_formularios_respuesta` VALUES (1,1,'123',0,1,'2025-03-03 09:44:58',NULL,NULL,1,1),(2,2,NULL,1,NULL,'2025-03-03 12:09:45',NULL,NULL,1,1),(3,2,NULL,1,NULL,'2025-03-03 12:12:43',NULL,NULL,1,1),(4,2,NULL,1,NULL,'2025-03-03 12:13:29',NULL,NULL,1,1),(5,2,NULL,1,NULL,'2025-03-03 12:20:41',NULL,NULL,1,1),(6,2,NULL,1,NULL,'2025-03-03 12:22:23',NULL,NULL,1,1),(7,2,NULL,1,NULL,'2025-03-03 12:24:30',NULL,NULL,1,1),(8,2,NULL,1,NULL,'2025-03-03 12:29:17',NULL,NULL,1,1),(9,2,NULL,1,NULL,'2025-03-03 12:37:37',NULL,NULL,1,1),(10,2,NULL,1,NULL,'2025-03-04 12:27:36',NULL,NULL,1,1),(11,2,NULL,1,NULL,'2025-03-04 12:29:54',NULL,NULL,1,1),(12,2,NULL,1,NULL,'2025-03-04 13:52:20',NULL,NULL,1,1),(13,2,NULL,1,NULL,'2025-03-04 14:37:48',NULL,NULL,1,1),(14,2,NULL,1,NULL,'2025-03-05 09:52:50',NULL,NULL,1,1),(15,2,NULL,1,NULL,'2025-03-05 10:09:20',NULL,NULL,1,1),(16,2,NULL,1,NULL,'2025-03-05 10:47:03',NULL,NULL,1,1),(17,2,NULL,1,NULL,'2025-03-05 11:04:44',NULL,NULL,1,1),(18,2,NULL,1,NULL,'2025-03-05 11:18:18',NULL,NULL,1,1),(19,2,NULL,1,NULL,'2025-03-05 11:21:21',NULL,NULL,1,1),(20,2,NULL,1,NULL,'2025-03-05 11:27:41',NULL,NULL,1,1),(21,2,NULL,1,NULL,'2025-03-05 11:33:05',NULL,NULL,1,1),(22,2,NULL,1,NULL,'2025-03-05 11:35:09',NULL,NULL,1,1),(23,2,NULL,1,NULL,'2025-03-05 12:29:43',NULL,NULL,1,1),(24,2,NULL,1,NULL,'2025-03-05 15:41:54',NULL,NULL,1,1),(25,1,NULL,1,NULL,'2025-03-05 15:46:52',NULL,NULL,1,1),(26,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(27,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(28,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(29,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(30,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(31,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(32,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(33,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(34,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(35,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(36,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(37,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(38,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(39,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(40,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(41,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(42,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(43,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(44,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(45,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(46,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(47,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(48,1,NULL,1,NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(49,2,NULL,1,NULL,'2025-03-05 16:02:57',NULL,NULL,1,1),(50,2,NULL,1,NULL,'2025-03-05 16:07:32',NULL,NULL,1,1),(51,2,NULL,1,NULL,'2025-03-05 16:07:54',NULL,NULL,1,1),(52,2,NULL,1,NULL,'2025-03-05 16:08:49',NULL,NULL,1,1),(53,2,NULL,1,NULL,'2025-03-05 16:11:10',NULL,NULL,1,1),(54,2,NULL,1,NULL,'2025-03-05 16:11:27',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_formularios_respuesta` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_menu`
--

DROP TABLE IF EXISTS `bt_menu`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_menu` (
  `CMENU_ID` varchar(8) NOT NULL,
  `CMENU_NOMBRE` varchar(100) NOT NULL,
  `CMENU_ID_ORIGEN` varchar(8) DEFAULT NULL,
  `NMENU_ORDENAMIENTO` int DEFAULT NULL,
  `CMENU_RUTA` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `CMENU_ICONO` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `NAUDI_REG_INS` int NOT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NMENU_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`CMENU_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_menu`
--

LOCK TABLES `bt_menu` WRITE;
/*!40000 ALTER TABLE `bt_menu` DISABLE KEYS */;
INSERT INTO `bt_menu` VALUES ('10000001','Usuarios',NULL,4,'/admin/usuarios','heroicons_outline:users',1,'2025-02-26 12:03:08',NULL,NULL,1,1),('11000001','Perfil',NULL,3,'/admin/apps/profile',NULL,1,'2025-02-25 16:15:54',NULL,NULL,1,1),('11000002','Configuraciones',NULL,4,'/admin/apps/settings',NULL,1,'2025-02-25 16:16:25',NULL,NULL,1,1),('12000001','Maestras',NULL,3,NULL,'heroicons_outline:users',1,'2025-02-26 12:03:31',NULL,NULL,1,1),('12000002','Catálogo Detalle','12000001',4,'/admin/maestras/catalogo-detalle','heroicons_outline:rectangle-group',1,'2025-02-26 12:04:12',NULL,NULL,1,1),('20000001','Dashboard',NULL,1,'/admin/dashboard','heroicons_outline:chart-pie',1,'2025-02-25 16:17:58',NULL,NULL,1,1),('30000001','Bolsa de Trabajo',NULL,2,NULL,'heroicons_outline:chart-pie',1,'2025-02-26 16:23:09',NULL,NULL,1,1),('30000002','Convocatorias','30000001',2,'/admin/bolsa/convocatorias','heroicons_outline:chart-pie',1,'2025-02-26 16:26:48',NULL,NULL,1,1),('30000004','Listar Postulantes','30000001',3,'/admin/bolsa/listar-postulantes','heroicons_outline:chart-pie',1,'2025-05-12 17:15:30',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_menu` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_menu_roles`
--

DROP TABLE IF EXISTS `bt_menu_roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_menu_roles` (
  `NROME_ID` int NOT NULL AUTO_INCREMENT,
  `NROLE_ID` int NOT NULL,
  `CMENU_ID` varchar(8) NOT NULL,
  `NROME_VISIBLE` int NOT NULL DEFAULT '1',
  `NROLE_ORDENAMIENTO` int DEFAULT NULL,
  `NAUDI_REG_INS` int NOT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NROME_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`NROME_ID`),
  KEY `frm_menu_roles_frm_roles_FK` (`NROLE_ID`),
  KEY `frm_menu_roles_frm_menu_FK` (`CMENU_ID`),
  CONSTRAINT `frm_menu_roles_frm_menu_FK` FOREIGN KEY (`CMENU_ID`) REFERENCES `bt_menu` (`CMENU_ID`) ON UPDATE CASCADE,
  CONSTRAINT `frm_menu_roles_frm_roles_FK` FOREIGN KEY (`NROLE_ID`) REFERENCES `bt_roles` (`NROLE_ID`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_menu_roles`
--

LOCK TABLES `bt_menu_roles` WRITE;
/*!40000 ALTER TABLE `bt_menu_roles` DISABLE KEYS */;
INSERT INTO `bt_menu_roles` VALUES (1,1,'11000001',0,NULL,1,'2025-02-25 16:19:28',NULL,NULL,1,1),(2,1,'11000002',0,NULL,1,'2025-02-25 16:19:43',NULL,NULL,1,1),(3,1,'20000001',1,NULL,1,'2025-02-25 16:20:10',NULL,NULL,1,1),(4,1,'10000001',1,NULL,1,'2025-02-26 12:05:10',NULL,NULL,1,1),(5,1,'12000001',1,NULL,1,'2025-02-26 12:05:35',NULL,NULL,1,1),(6,1,'12000002',1,NULL,1,'2025-02-26 12:05:52',NULL,NULL,1,1),(7,1,'30000001',1,NULL,1,'2025-02-26 16:23:20',NULL,NULL,1,1),(8,1,'30000002',1,NULL,1,'2025-02-26 16:27:05',NULL,NULL,1,1),(10,1,'30000004',0,NULL,1,'2025-05-12 17:15:58',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_menu_roles` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_persona`
--

DROP TABLE IF EXISTS `bt_persona`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_persona` (
  `NPERS_ID` int NOT NULL AUTO_INCREMENT,
  `CPERS_APE_PATERNO` varchar(150) DEFAULT NULL,
  `CPERS_APE_MATERNO` varchar(150) DEFAULT NULL,
  `CPERS_NOMBRES` varchar(150) DEFAULT NULL,
  `NCADE_ID_SEXO` int DEFAULT NULL,
  `CPERS_CORREO` varchar(150) DEFAULT NULL,
  `CPERS_AVATAR` varchar(150) DEFAULT NULL,
  `NCADE_ID_TIPO_DOCUMENTO` int DEFAULT NULL,
  `CPERS_NRO_DOCUMENTO` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `DPERS_FEC_NACIMIENTO` date DEFAULT NULL,
  `CPERS_TELEFONO` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `CPERS_BIO` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci,
  `NAUDI_REG_INS` int NOT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NPERS_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`NPERS_ID`),
  KEY `frm_persona_frm_catalogo_detalle_FK` (`NCADE_ID_SEXO`),
  CONSTRAINT `frm_persona_frm_catalogo_detalle_FK` FOREIGN KEY (`NCADE_ID_SEXO`) REFERENCES `bt_catalogo_detalle` (`NCADE_ID`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_persona`
--

LOCK TABLES `bt_persona` WRITE;
/*!40000 ALTER TABLE `bt_persona` DISABLE KEYS */;
INSERT INTO `bt_persona` VALUES (1,'GUERREROS','ECHIA','JAYRO',11000001,'jguerreros@derrama.org.pe',NULL,10000001,'70236552','1994-12-05','993908435','Hola soy Jayro Guerrs',1,'2025-02-25 15:06:51',1,'2025-05-13 17:20:28',1,1),(2,'FAWEF','FAWEF','FAWEF',NULL,'jayroguerreros@gmail.com',NULL,NULL,NULL,NULL,NULL,NULL,1,'2025-05-13 17:21:02',NULL,NULL,1,1),(3,'VEAA','SERVESR','JAYRO',NULL,'jayroguerrderos@gmail.com',NULL,NULL,NULL,NULL,NULL,NULL,1,'2025-05-13 17:23:35',NULL,NULL,1,1),(4,'WQEQWE','GFDGFD','WAERWAER',NULL,'fawefaw@fawef.com',NULL,NULL,NULL,NULL,NULL,NULL,1,'2025-05-13 17:24:29',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_persona` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_postulaciones`
--

DROP TABLE IF EXISTS `bt_postulaciones`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_postulaciones` (
  `NPOST_ID` int NOT NULL AUTO_INCREMENT,
  `NUSUA_ID` int DEFAULT NULL,
  `NCADE_TIPO_DOCUMENTO` int DEFAULT NULL,
  `CPOST_NUMDOC` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `CPOST_NOMBRES` varchar(100) DEFAULT NULL,
  `CPOST_PATERNO` varchar(100) DEFAULT NULL,
  `CPOST_MATERNO` varchar(100) DEFAULT NULL,
  `CPOST_CORREO` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `CPOST_CELULAR` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `NPUEST_ID` int DEFAULT NULL,
  `CPOST_ARCHIVO` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `NAUDI_REG_INS` int DEFAULT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NUARO_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`NPOST_ID`),
  KEY `bt_postulaciones_bt_usuario_fk` (`NUSUA_ID`),
  KEY `bt_postulaciones_bt_puestos_fk` (`NPUEST_ID`),
  CONSTRAINT `bt_postulaciones_bt_puestos_fk` FOREIGN KEY (`NPUEST_ID`) REFERENCES `bt_puestos` (`NPUEST_ID`) ON UPDATE CASCADE,
  CONSTRAINT `bt_postulaciones_bt_usuario_fk` FOREIGN KEY (`NUSUA_ID`) REFERENCES `bt_usuario` (`NUSUA_ID`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_postulaciones`
--

LOCK TABLES `bt_postulaciones` WRITE;
/*!40000 ALTER TABLE `bt_postulaciones` DISABLE KEYS */;
INSERT INTO `bt_postulaciones` VALUES (9,NULL,10000001,'70236552','JAYRO','GUERREROS','ECHIA','jayroguerreros@gmail.com','993908435',1,'/Postulaciones/1/70236552.pdf',NULL,'2025-04-11 17:05:36',NULL,NULL,1,1),(10,NULL,10000001,'70234936','CARLOS','GUERREROS ','ECHIA','cfguerreros@gmail.com','993824563',1,'/Postulaciones/1/70234936.pdf',NULL,'2025-04-11 17:09:12',NULL,NULL,1,1),(11,NULL,10000001,'70236552','pepito','fawefa','cawefaw','jayroguerreros@gmail.com','993908435',4,'/Postulaciones/4/70236552.pdf',NULL,'2025-05-13 16:39:39',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_postulaciones` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_preguntas`
--

DROP TABLE IF EXISTS `bt_preguntas`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_preguntas` (
  `NPREG_ID` int NOT NULL AUTO_INCREMENT,
  `NFORM_ID` int NOT NULL,
  `CPREG_DESCRIPCION` mediumtext NOT NULL,
  `CPREG_ALTERNATIVAS` longtext,
  `NPREG_ORDENAMIENTO` int DEFAULT NULL,
  `NPREG_OBLIGATORIO` int NOT NULL DEFAULT '0',
  `NCANT_ARCHIVOS` int DEFAULT NULL,
  `NCADE_TIPO_PREG` int DEFAULT NULL,
  `NPREG_ES_FECHA` int NOT NULL DEFAULT '0',
  `NPREG_ES_NUMERO` int NOT NULL DEFAULT '0',
  `NPREG_ES_CORREO` int NOT NULL DEFAULT '0',
  `NPREG_ES_REGEXP` int NOT NULL DEFAULT '0',
  `NAUDI_USR_INS` int NOT NULL,
  `DAUDI_USR_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `NAUDI_USR_UPD` int DEFAULT NULL,
  `DAUDI_USR_UPD` datetime DEFAULT NULL,
  `NPREG_ESTADO` int NOT NULL DEFAULT '1',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1',
  PRIMARY KEY (`NPREG_ID`),
  KEY `frm_preguntas_frm_encuestas_FK` (`NFORM_ID`),
  KEY `frm_preguntas_frm_catalogo_detalle_FK` (`NCADE_TIPO_PREG`),
  CONSTRAINT `frm_preguntas_frm_catalogo_detalle_FK` FOREIGN KEY (`NCADE_TIPO_PREG`) REFERENCES `bt_catalogo_detalle` (`NCADE_ID`) ON UPDATE CASCADE,
  CONSTRAINT `frm_preguntas_frm_encuestas_FK` FOREIGN KEY (`NFORM_ID`) REFERENCES `bt_formularios` (`NFORM_ID`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_preguntas`
--

LOCK TABLES `bt_preguntas` WRITE;
/*!40000 ALTER TABLE `bt_preguntas` DISABLE KEYS */;
INSERT INTO `bt_preguntas` VALUES (1,1,'Seleccione la maestría de su interés','[Maestría en Formación Docente;Maestría en Políticas públicas de educación]',1,1,NULL,13000001,0,0,0,0,1,'2025-02-26 16:36:01',NULL,NULL,1,1),(2,1,'Nombres completos',NULL,2,1,NULL,13000002,0,0,0,0,1,'2025-02-27 14:14:59',NULL,NULL,1,1),(3,1,'Apellidos Paterno',NULL,3,0,NULL,13000002,0,0,0,0,1,'2025-02-27 14:16:00',NULL,NULL,1,1),(4,1,'Apellidos materno',NULL,4,0,NULL,13000002,0,0,0,0,1,'2025-02-27 14:16:30',NULL,NULL,1,1),(5,1,'Número de celular',NULL,5,0,NULL,13000002,0,0,0,0,1,'2025-02-27 14:17:35',NULL,NULL,1,1),(6,1,'Correo electrónico',NULL,6,0,NULL,13000002,0,0,1,0,1,'2025-02-27 14:18:10',NULL,NULL,1,1),(7,1,'Fecha de nacimiento',NULL,7,0,NULL,13000002,1,0,0,0,1,'2025-02-27 14:18:51',NULL,NULL,1,1),(8,1,'Nacionalidad','14',8,0,NULL,13000001,0,0,0,0,1,'2025-02-27 14:19:13',NULL,NULL,1,1),(9,1,'Género/ Sexo','11',9,0,NULL,13000001,0,0,0,0,1,'2025-02-27 14:23:39',NULL,NULL,1,1),(10,1,'Domicilio',NULL,10,0,NULL,13000002,0,0,0,0,1,'2025-02-27 14:24:40',NULL,NULL,1,1),(11,1,'Distrito',NULL,11,0,NULL,13000002,0,0,0,0,1,'2025-02-27 14:24:56',NULL,NULL,1,1),(12,1,'Provincia',NULL,12,0,NULL,13000002,0,0,0,0,1,'2025-02-27 14:26:42',NULL,NULL,1,1),(13,1,'Departamento',NULL,13,0,NULL,13000002,0,0,0,0,1,'2025-02-27 14:26:42',NULL,NULL,1,1),(14,1,'Tipo de documento de identidad','10',14,0,NULL,13000001,0,0,0,0,1,'2025-02-27 14:27:39',NULL,NULL,1,1),(15,1,'Documento de identidad ',NULL,15,0,NULL,13000002,0,0,0,0,1,'2025-02-27 14:28:09',NULL,NULL,1,1),(16,1,'Estado civil','15',16,0,NULL,13000001,0,0,0,0,1,'2025-02-27 14:31:17',NULL,NULL,1,1),(17,1,'Código postal',NULL,17,0,NULL,13000002,0,0,0,0,1,'2025-02-27 14:34:38',NULL,NULL,1,1),(18,1,'¿Cuál es el principal nivel de enseñanza en el que ejerces la docencia?','16',18,0,NULL,13000001,0,0,0,0,1,'2025-02-27 14:40:42',NULL,NULL,1,1),(20,1,'Autorización de tratamiento de datos personales','[hola mundo;soy pucp]',19,0,NULL,13000001,0,0,0,0,1,'2025-02-27 15:40:38',NULL,NULL,1,1),(21,1,'Autorización de tratamiento de datos personales','[Declaro que toda la información consignada es verídica y autorizo el tratamiento de mis datos personales para la participación del curso, conforme al siguiente enlace. Sin mi autorización, no podré recibir la información]',20,0,NULL,13000006,0,0,0,0,1,'2025-02-27 17:08:40',NULL,NULL,1,1),(22,1,'Cargue aquí sus requisitos de postulación',NULL,21,0,5,13000004,0,0,0,0,1,'2025-02-28 11:26:56',NULL,NULL,1,1),(23,1,'Elige tu sexo','11',22,1,NULL,13000003,0,0,0,0,1,'2025-02-28 12:09:37',NULL,NULL,1,1),(24,2,'Elige tu sexo','11',1,1,2,13000004,0,0,0,0,1,'2025-02-28 15:36:42',NULL,NULL,1,1),(25,2,'Elige tu sexo','11',2,1,NULL,13000002,1,0,0,0,1,'2025-02-28 17:01:25',NULL,NULL,0,0);
/*!40000 ALTER TABLE `bt_preguntas` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_puestos`
--

DROP TABLE IF EXISTS `bt_puestos`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_puestos` (
  `NPUEST_ID` int NOT NULL AUTO_INCREMENT,
  `CPUEST_TITULO` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `CPUEST_DESCRIPCION` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci,
  `DPUEST_FECHA_INI` date NOT NULL,
  `DPUEST_FECHA_FIN` date NOT NULL,
  `NDIST_ID` int DEFAULT NULL,
  `CPUEST_IMAGEN` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `NAUDI_REG_INS` int NOT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NPUEST_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`NPUEST_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_puestos`
--

LOCK TABLES `bt_puestos` WRITE;
/*!40000 ALTER TABLE `bt_puestos` DISABLE KEYS */;
INSERT INTO `bt_puestos` VALUES (1,'JEFE DE TALENTOS','SE <strong>NECESITA</strong> UN JEFE DE TALENTO','2024-04-01','2024-04-30',1,'images/pages/profile/cover.jpg',1,'2025-03-12 12:09:53',1,'2025-04-28 16:55:56',1,1),(2,'ESF',NULL,'2025-04-08','2025-04-30',1,NULL,1,'2025-04-28 17:19:03',NULL,NULL,1,1),(3,'QAQS',NULL,'2025-05-07','2025-05-22',1,NULL,1,'2025-05-13 15:12:34',NULL,NULL,1,1),(4,'ASADO','<p>fewfwaefawef</p>','2025-05-28','2025-05-31',1,NULL,1,'2025-05-13 15:14:17',1,'2025-05-13 16:19:46',1,1),(5,'PRUEBITA',NULL,'2025-05-29','2025-05-31',1,NULL,1,'2025-05-13 15:41:48',1,'2025-05-13 15:53:57',1,0),(6,'PRUEBOTA','<p>CAEFWAE</p>','2025-05-20','2025-05-21',1,NULL,1,'2025-05-13 15:42:56',1,'2025-05-13 15:53:29',1,0),(7,'FWAEF','<p>fawef</p>','2025-05-27','2025-05-28',1,NULL,1,'2025-05-13 15:45:55',1,'2025-05-13 15:51:05',1,0);
/*!40000 ALTER TABLE `bt_puestos` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_respuestas`
--

DROP TABLE IF EXISTS `bt_respuestas`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_respuestas` (
  `NRESP_ID` int NOT NULL AUTO_INCREMENT,
  `NPREG_ID` int DEFAULT NULL,
  `NFORES_ID` int NOT NULL,
  `CPREG_RESPUESTA` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci,
  `NAUDI_USR_INS` int DEFAULT NULL,
  `DAUDI_USR_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `NAUDI_USR_UPD` int DEFAULT NULL,
  `DAUDI_USR_UPD` datetime DEFAULT NULL,
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1',
  `NRESP_ESTADO` int NOT NULL DEFAULT '1',
  PRIMARY KEY (`NRESP_ID`),
  KEY `frm_respuestas_frm_preguntas_FK` (`NPREG_ID`),
  KEY `frm_respuestas_frm_formularios_respuesta_FK` (`NFORES_ID`),
  CONSTRAINT `frm_respuestas_frm_formularios_respuesta_FK` FOREIGN KEY (`NFORES_ID`) REFERENCES `bt_formularios_respuesta` (`NFORES_ID`) ON UPDATE CASCADE,
  CONSTRAINT `frm_respuestas_frm_preguntas_FK` FOREIGN KEY (`NPREG_ID`) REFERENCES `bt_preguntas` (`NPREG_ID`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=71 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_respuestas`
--

LOCK TABLES `bt_respuestas` WRITE;
/*!40000 ALTER TABLE `bt_respuestas` DISABLE KEYS */;
INSERT INTO `bt_respuestas` VALUES (22,24,1,'MASCULINO',NULL,'2025-02-28 16:39:35',NULL,NULL,1,1),(23,24,1,'Anexo1 - Detalle de Observaciones.docx',NULL,'2025-03-03 09:36:21',NULL,NULL,1,1),(24,24,1,'Google Looker Studio.docx',NULL,'2025-03-03 12:22:23',NULL,NULL,1,1),(25,24,7,'GUERREROS ECHIA JAYRO.docx',NULL,'2025-03-03 12:24:30',NULL,NULL,1,1),(26,24,8,'Obs CMS.docx',NULL,'2025-03-03 12:29:17',NULL,NULL,1,1),(27,24,9,'GUERREROS ECHIA JAYRO.pdf',NULL,'2025-03-03 12:37:37',NULL,NULL,1,1),(28,25,10,'',NULL,'2025-03-04 12:27:36',NULL,NULL,1,1),(29,25,11,'',NULL,'2025-03-04 12:29:54',NULL,NULL,1,1),(30,25,12,'2025-03-29T05:00:00.000Z',NULL,'2025-03-04 13:52:20',NULL,NULL,1,1),(31,25,13,'2025-03-13T00:00:00.000Z',NULL,'2025-03-04 14:37:48',NULL,NULL,1,1),(32,24,14,'ListaUsuarios_5_3_2025 (7).pdf',NULL,'2025-03-05 09:52:50',NULL,NULL,1,1),(33,24,15,'ListaUsuarios_5_3_2025 (7).pdf',NULL,'2025-03-05 10:09:20',NULL,NULL,1,1),(34,24,16,'ListaUsuarios_5_3_2025.pdf',NULL,'2025-03-05 10:47:03',NULL,NULL,1,1),(35,24,17,'CV - JAYRO GUERREROS.docx',NULL,'2025-03-05 11:04:44',NULL,NULL,1,1),(36,24,18,'CV - JAYRO GUERREROS_24.docx',NULL,'2025-03-05 11:18:18',NULL,NULL,1,1),(37,24,19,'Tarea 3 Power BI_24.docx',NULL,'2025-03-05 11:21:21',NULL,NULL,1,1),(38,24,20,'Formato_de_Expresion_de_interes_24.docx',NULL,'2025-03-05 11:27:41',NULL,NULL,1,1),(39,24,21,'ListaUsuarios_5_3_2025_24.pdf',NULL,'2025-03-05 11:33:05',NULL,NULL,1,1),(40,24,22,'ListaUsuarios_5_3_2025 (8)_24.pdf|ListaUsuarios_5_3_2025 (7)_24.pdf',NULL,'2025-03-05 11:35:09',NULL,NULL,1,1),(41,24,23,'ListaUsuarios_5_3_2025_24.pdf',NULL,'2025-03-05 12:29:43',NULL,NULL,1,1),(42,24,24,'ListaUsuarios_5_3_2025 (3)_24.pdf|ListaUsuarios_5_3_2025 (2)_24.pdf',NULL,'2025-03-05 15:41:54',NULL,NULL,1,1),(43,1,25,'Maestría en Políticas públicas de educación',NULL,'2025-03-05 15:46:52',NULL,NULL,1,1),(44,2,26,'FFAWEF',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(45,3,27,'FAWE',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(46,4,28,'FAWEF',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(47,5,29,'AEWFAEWF',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(48,6,30,'FAWEF@FAWEF.COM',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(49,7,31,'2025-03-18T00:00:00.000Z',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(50,8,32,'ARGENTINA',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(51,9,33,'MASCULINO',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(52,10,34,'FAWEF',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(53,11,35,'FAWEF',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(54,12,36,'FAAWEF',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(55,13,37,'FAWEF',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(56,14,38,'DNI',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(57,15,39,'123213',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(58,16,40,'SOLTERO(A)',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(59,17,41,'123FAWF',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(60,18,42,'EDUCACIÓN BÁSICA REGULAR (EBR) - SECUNDARIA',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(61,20,43,'hola mundo',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(62,21,44,'Declaro que toda la información consignada es verídica y autorizo el tratamiento de mis datos personales para la participación del curso',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(63,22,47,'ListaUsuarios_5_3_2025 (6)_22.pdf|ListaUsuarios_5_3_2025 (5)_22.pdf|ListaUsuarios_5_3_2025 (4)_22.pdf|ListaUsuarios_5_3_2025 (3)_22.pdf',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(64,23,48,'MASCULINO',NULL,'2025-03-05 15:46:53',NULL,NULL,1,1),(65,24,49,'ListaUsuarios_5_3_2025_24.pdf',NULL,'2025-03-05 16:02:57',NULL,NULL,1,1),(66,24,50,'ListaUsuarios_5_3_2025 (1)_24.pdf',NULL,'2025-03-05 16:07:32',NULL,NULL,1,1),(67,24,51,'ListaUsuarios_5_3_2025 (1)_24.pdf',NULL,'2025-03-05 16:07:54',NULL,NULL,1,1),(68,24,52,'ListaUsuarios_5_3_2025 (1)_24.pdf',NULL,'2025-03-05 16:08:49',NULL,NULL,1,1),(69,24,53,'ListaUsuarios_5_3_2025 (1)_24.pdf',NULL,'2025-03-05 16:11:10',NULL,NULL,1,1),(70,24,54,'Ficha de autorización (1)_24.pdf',NULL,'2025-03-05 16:11:27',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_respuestas` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_roles`
--

DROP TABLE IF EXISTS `bt_roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_roles` (
  `NROLE_ID` int NOT NULL AUTO_INCREMENT,
  `NTIRO_ID` int NOT NULL,
  `CROLE_CODIGO` varchar(100) NOT NULL,
  `CROLE_NOMBRE` varchar(100) NOT NULL,
  `NAUDI_REG_INS` int NOT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NROLE_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`NROLE_ID`),
  KEY `frm_roles_frm_tipo_roles_FK` (`NTIRO_ID`),
  CONSTRAINT `frm_roles_frm_tipo_roles_FK` FOREIGN KEY (`NTIRO_ID`) REFERENCES `bt_tipo_roles` (`NTIRO_ID`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_roles`
--

LOCK TABLES `bt_roles` WRITE;
/*!40000 ALTER TABLE `bt_roles` DISABLE KEYS */;
INSERT INTO `bt_roles` VALUES (1,1,'ROL001','ADMINISTRADOR',1,'2025-02-25 15:10:58',NULL,NULL,1,1),(2,1,'ROL002','USUARIO',1,'2025-02-25 15:11:15',NULL,NULL,1,1),(3,1,'ROL003','POSTULANTE',1,'2025-03-12 11:36:08',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_roles` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_tipo_roles`
--

DROP TABLE IF EXISTS `bt_tipo_roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_tipo_roles` (
  `NTIRO_ID` int NOT NULL AUTO_INCREMENT,
  `CTIRO_CODIGO` varchar(100) NOT NULL,
  `CTIRO_DESCRIPCION` varchar(100) DEFAULT NULL,
  `NAUDI_REG_INS` int NOT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NTIRO_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`NTIRO_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_tipo_roles`
--

LOCK TABLES `bt_tipo_roles` WRITE;
/*!40000 ALTER TABLE `bt_tipo_roles` DISABLE KEYS */;
INSERT INTO `bt_tipo_roles` VALUES (1,'TRO001','ADMINISTRADOR',1,'2025-02-25 15:10:17',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_tipo_roles` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_usuario`
--

DROP TABLE IF EXISTS `bt_usuario`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_usuario` (
  `NUSUA_ID` int NOT NULL AUTO_INCREMENT COMMENT 'OK TABLA SRD_USUARIOS',
  `NPERS_ID` int DEFAULT NULL,
  `CUSUA_USERNAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT 'USERNAME',
  `CUSUA_PASSWORD` varchar(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT 'CONTRASEÑA USUARIO',
  `CUSUA_TOKEN` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT 'TOKEN USUARIO',
  `DUSUA_TOKEN_VENC` varchar(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL,
  `NAUDI_REG_INS` int NOT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NUSUA_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`NUSUA_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='TABLA DE USUARIOS';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_usuario`
--

LOCK TABLES `bt_usuario` WRITE;
/*!40000 ALTER TABLE `bt_usuario` DISABLE KEYS */;
INSERT INTO `bt_usuario` VALUES (1,1,'jguerreros','8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918','79bd5a32-3048-11f0-8297-04d9c869e560','2025-05-14 17:20:28',1,'2025-02-25 15:07:20',1,'2025-05-13 17:20:28',1,1),(2,2,'15084',NULL,'8dd6acc5-3048-11f0-8297-04d9c869e560','2025-05-14 17:21:02',1,'2025-05-13 17:21:02',NULL,NULL,1,1),(3,3,'15142',NULL,'e963be38-3048-11f0-8297-04d9c869e560','2025-05-14 17:23:35',1,'2025-05-13 17:23:35',NULL,NULL,1,1),(4,4,'45236',NULL,'092ab1fa-3049-11f0-8297-04d9c869e560','2025-05-14 17:24:29',1,'2025-05-13 17:24:29',NULL,NULL,1,1);
/*!40000 ALTER TABLE `bt_usuario` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `bt_usuario_asig_roles`
--

DROP TABLE IF EXISTS `bt_usuario_asig_roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `bt_usuario_asig_roles` (
  `NUARO_ID` int NOT NULL AUTO_INCREMENT,
  `NUSUA_ID` int DEFAULT NULL,
  `NROLE_ID` int DEFAULT NULL,
  `NUARO_FLAG_PREDETERMINADO` int NOT NULL DEFAULT '0',
  `DUARO_FEC_INICIO` date DEFAULT NULL,
  `DUARO_FEC_FIN` date DEFAULT NULL,
  `NAUDI_REG_INS` int NOT NULL,
  `DAUDI_REG_INS` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'AUDITORIA: FECHA REGISTRO',
  `NAUDI_REG_UPD` int DEFAULT NULL,
  `DAUDI_REG_UPD` datetime DEFAULT NULL COMMENT 'AUDITORIA: FECHA ACTUALIZACIÓN',
  `NUARO_ESTADO` int NOT NULL DEFAULT '1' COMMENT 'ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  `NAUDI_EST_REG` int NOT NULL DEFAULT '1' COMMENT 'AUDITORIA: ESTADO REGISTRO (1=ACTIVO, 0=INACTIVO)',
  PRIMARY KEY (`NUARO_ID`),
  KEY `frm_usuario_asig_roles_frm_usuario_FK` (`NUSUA_ID`),
  KEY `frm_usuario_asig_roles_frm_roles_FK` (`NROLE_ID`),
  CONSTRAINT `frm_usuario_asig_roles_frm_roles_FK` FOREIGN KEY (`NROLE_ID`) REFERENCES `bt_roles` (`NROLE_ID`) ON UPDATE CASCADE,
  CONSTRAINT `frm_usuario_asig_roles_frm_usuario_FK` FOREIGN KEY (`NUSUA_ID`) REFERENCES `bt_usuario` (`NUSUA_ID`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `bt_usuario_asig_roles`
--

LOCK TABLES `bt_usuario_asig_roles` WRITE;
/*!40000 ALTER TABLE `bt_usuario_asig_roles` DISABLE KEYS */;
INSERT INTO `bt_usuario_asig_roles` VALUES (1,1,1,1,NULL,NULL,1,'2025-02-25 15:12:31',1,'2025-05-13 17:20:28',1,1),(2,2,1,0,NULL,NULL,1,'2025-05-13 17:21:02',1,'2025-05-13 17:25:46',1,0),(6,3,1,0,NULL,NULL,1,'2025-05-13 17:23:35',1,'2025-05-13 17:25:45',1,0),(10,4,1,0,NULL,NULL,1,'2025-05-13 17:24:29',1,'2025-05-13 17:25:42',1,0);
/*!40000 ALTER TABLE `bt_usuario_asig_roles` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Dumping routines for database 'dmbolsa'
--
/*!50003 DROP PROCEDURE IF EXISTS `SP_CATALOGO_DETALLE_LISTAR` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_CATALOGO_DETALLE_LISTAR`(
	IN P_NCATA_ID INT,
    IN P_NCADE_ESTADO INT,
    IN P_CCADE_NOMBRE VARCHAR(255),
    IN P_ORDER_BY VARCHAR(100),
    IN P_ORDER VARCHAR(100)
)
BEGIN
	DECLARE V_CCADE_NOMBRE VARCHAR(150);
	DECLARE V_ESTADO INT;
    DECLARE V_NCATA_ID INT;
    DECLARE V_RECORDCOUNT INT;
    DECLARE V_ORDER_BY VARCHAR(100);
    DECLARE V_ORDER VARCHAR(100);
    DECLARE V_QUERY_ORDEN VARCHAR(500);
	
   	SET V_CCADE_NOMBRE = IFNULL(P_CCADE_NOMBRE, '');
   
    
    SET V_ESTADO = IFNULL(P_NCADE_ESTADO, -1);
    SET V_NCATA_ID = IFNULL(P_NCATA_ID, -1);
    SET V_ORDER_BY = IFNULL(P_ORDER_BY, '');
    SET V_ORDER = IFNULL(P_ORDER, '');

    
    IF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(V_ESTADO, 0) <> 2 THEN
        SET V_QUERY_ORDEN = 'E.CCATA_NOMBRE';
        SET V_ORDER = 'ASC';
    ELSEIF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(V_ESTADO, 0) = 2 THEN
        SET V_ORDER = 'DESC';
        SET V_QUERY_ORDEN = 'IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)';
    ELSEIF V_ORDER_BY = 'codigo' THEN
        SET V_QUERY_ORDEN = 'D.CCADE_CODIGO';
    ELSEIF V_ORDER_BY = 'abreviatura' THEN
        SET V_QUERY_ORDEN = 'D.CCADE_ABREVIATURA';
    ELSEIF V_ORDER_BY = 'nombre' THEN
        SET V_QUERY_ORDEN = 'D.CCADE_NOMBRE';
    ELSEIF V_ORDER_BY = 'catalogo' THEN
        SET V_QUERY_ORDEN = 'E.CCATA_NOMBRE';
    ELSEIF V_ORDER_BY = 'fechaCreacion' THEN
        SET V_QUERY_ORDEN = 'IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)';
    ELSEIF V_ORDER_BY = 'usuarioCreacion' THEN
        SET V_QUERY_ORDEN = 'D.CAUDI_USR_INS';
    ELSEIF V_ORDER_BY = 'estado' THEN
        SET V_QUERY_ORDEN = 'FA_OBT_TEXTO_CAT(12, D.NCADE_ESTADO)';
    ELSE
        SET V_QUERY_ORDEN = 'IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)';
    END IF;

    
    SELECT COUNT(1)
    INTO V_RECORDCOUNT
    FROM dmforms.FRM_CATALOGO_DETALLE D
    WHERE D.NAUDI_EST_REG = 1
      AND (D.NCATA_ID = V_NCATA_ID OR V_NCATA_ID = -1)
      AND (D.NCADE_ESTADO = V_ESTADO OR V_ESTADO = -1)
      AND (CONCAT(D.CCADE_CODIGO, ' ', D.CCADE_NOMBRE) LIKE CONCAT('%', UPPER(V_CCADE_NOMBRE), '%'));

    
    SELECT 
    	ROW_NUMBER() OVER () NUMERO,
        D.NCADE_ID,
        D.CCADE_CODIGO,
        D.CCADE_NOMBRE,
        D.CCADE_ABREVIATURA,
        E.NCATA_ID,
        E.CCATA_NOMBRE,
        IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS) AS FECHA_MODIFICACION,
        CONCAT(Y.NUSUA_ID, ' - ', X.CPERS_APE_PATERNO, ' ', X.CPERS_APE_MATERNO, ', ', X.CPERS_NOMBRES) AS USUARIO_RESPONSABLE,
        Z.CCADE_NOMBRE ESTADO_TEXTO,
        D.NCADE_ESTADO
    FROM dmforms.FRM_CATALOGO_DETALLE D
    INNER JOIN dmforms.FRM_CATALOGO E ON D.NCATA_ID = E.NCATA_ID AND E.NCATA_ESTADO = 1 AND E.NAUDI_EST_REG = 1
    LEFT JOIN dmforms.FRM_CATALOGO_DETALLE Z ON Z.NCATA_ID = 12 AND Z.CCADE_CODIGO = D.NCADE_ESTADO
    LEFT JOIN dmforms.FRM_USUARIO Y ON Y.NUSUA_ID = IFNULL(D.NAUDI_USR_UPD, D.NAUDI_USR_INS) AND Y.NUSUA_ESTADO = 1 AND Y.NAUDI_EST_REG = 1
    LEFT JOIN dmforms.FRM_PERSONA X ON X.NPERS_ID = Y.NPERS_ID AND X.NPERS_ESTADO = 1 AND X.NAUDI_EST_REG = 1
    WHERE (D.NCATA_ID = V_NCATA_ID OR V_NCATA_ID = -1)
      AND D.NAUDI_EST_REG = 1
      AND (D.NCADE_ESTADO = V_ESTADO OR V_ESTADO = -1)
      AND (CONCAT(D.CCADE_CODIGO, ' ', D.CCADE_NOMBRE) LIKE CONCAT('%', UPPER(V_CCADE_NOMBRE), '%'))
    ORDER BY 
        CASE WHEN V_ORDER = 'ASC' THEN
            CASE V_QUERY_ORDEN
                WHEN 'D.CCADE_CODIGO' THEN D.CCADE_CODIGO
                WHEN 'D.CCADE_ABREVIATURA' THEN D.CCADE_ABREVIATURA
                WHEN 'D.CCADE_NOMBRE' THEN D.CCADE_NOMBRE
                WHEN 'E.CCATA_NOMBRE' THEN E.CCATA_NOMBRE
                WHEN 'IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)' THEN IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)
                WHEN 'D.CAUDI_USR_INS' THEN D.NAUDI_USR_INS
                
                ELSE IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)
            END
        END ASC,
        CASE WHEN V_ORDER = 'DESC' THEN
            CASE V_QUERY_ORDEN
                WHEN 'D.CCADE_CODIGO' THEN D.CCADE_CODIGO
                WHEN 'D.CCADE_ABREVIATURA' THEN D.CCADE_ABREVIATURA
                WHEN 'D.CCADE_NOMBRE' THEN D.CCADE_NOMBRE
                WHEN 'E.CCATA_NOMBRE' THEN E.CCATA_NOMBRE
                WHEN 'IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)' THEN IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)
                WHEN 'D.CAUDI_USR_INS' THEN D.NAUDI_USR_INS
                
                ELSE IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)
            END
        END DESC;
		
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_CATALOGO_DETALLE_LISTAR_CATALOGO` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_CATALOGO_DETALLE_LISTAR_CATALOGO`()
BEGIN
	
	SELECT D.NCATA_ID,
           D.CCATA_NOMBRE
    FROM dmforms.FRM_CATALOGO D
    WHERE D.NAUDI_EST_REG = 1 AND D.NCATA_ESTADO = 1
    ORDER BY D.CCATA_NOMBRE; 
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_CATALOGO_DETALLE_LISTAR_PAGINADO` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_CATALOGO_DETALLE_LISTAR_PAGINADO`(
	IN P_NCATA_ID INT,
    IN P_NCADE_ESTADO INT,
    IN P_CCADE_NOMBRE VARCHAR(255),
    IN P_PAGE_SIZE INT,
    IN P_PAGE_NUMBER INT,
    IN P_ORDER_BY VARCHAR(100),
    IN P_ORDER VARCHAR(100)
)
BEGIN
	DECLARE V_CCADE_NOMBRE VARCHAR(150);
	DECLARE V_ESTADO INT;
    DECLARE V_NCATA_ID INT;
    DECLARE V_CURRENTPAGE INT;
    DECLARE V_RECORDCOUNT INT;
    DECLARE V_PAGECOUNT INT;
    DECLARE V_PAGEINDEX INT;
    DECLARE V_ORDER_BY VARCHAR(100);
    DECLARE V_ORDER VARCHAR(100);
    DECLARE V_QUERY_ORDEN VARCHAR(500);
    DECLARE V_OFFSET INT;
	
   	SET V_CCADE_NOMBRE = IFNULL(P_CCADE_NOMBRE, '');
   
    
    SET V_ESTADO = IFNULL(P_NCADE_ESTADO, -1);
    SET V_NCATA_ID = IFNULL(P_NCATA_ID, -1);
    SET V_ORDER_BY = IFNULL(P_ORDER_BY, '');
    SET V_ORDER = IFNULL(P_ORDER, '');

    
    IF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(V_ESTADO, 0) <> 2 THEN
        SET V_QUERY_ORDEN = 'E.CCATA_NOMBRE';
        SET V_ORDER = 'ASC';
    ELSEIF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(V_ESTADO, 0) = 2 THEN
        SET V_ORDER = 'DESC';
        SET V_QUERY_ORDEN = 'IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)';
    ELSEIF V_ORDER_BY = 'codigo' THEN
        SET V_QUERY_ORDEN = 'D.CCADE_CODIGO';
    ELSEIF V_ORDER_BY = 'abreviatura' THEN
        SET V_QUERY_ORDEN = 'D.CCADE_ABREVIATURA';
    ELSEIF V_ORDER_BY = 'nombre' THEN
        SET V_QUERY_ORDEN = 'D.CCADE_NOMBRE';
    ELSEIF V_ORDER_BY = 'catalogo' THEN
        SET V_QUERY_ORDEN = 'E.CCATA_NOMBRE';
    ELSEIF V_ORDER_BY = 'fechaCreacion' THEN
        SET V_QUERY_ORDEN = 'IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)';
    ELSEIF V_ORDER_BY = 'usuarioCreacion' THEN
        SET V_QUERY_ORDEN = 'D.CAUDI_USR_INS';
    ELSEIF V_ORDER_BY = 'estado' THEN
        SET V_QUERY_ORDEN = 'FA_OBT_TEXTO_CAT(12, D.NCADE_ESTADO)';
    ELSE
        SET V_QUERY_ORDEN = 'IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)';
    END IF;

    
    SELECT COUNT(1)
    INTO V_RECORDCOUNT
    FROM dmforms.FRM_CATALOGO_DETALLE D
    WHERE D.NAUDI_EST_REG = 1
      AND (D.NCATA_ID = V_NCATA_ID OR V_NCATA_ID = -1)
      AND (D.NCADE_ESTADO = V_ESTADO OR V_ESTADO = -1)
      AND (CONCAT(D.CCADE_CODIGO, ' ', D.CCADE_NOMBRE) LIKE CONCAT('%', UPPER(V_CCADE_NOMBRE), '%'));

    
    SET V_CURRENTPAGE = P_PAGE_NUMBER;
    SET V_PAGECOUNT = CEIL(V_RECORDCOUNT / P_PAGE_SIZE);

    IF (V_CURRENTPAGE > V_PAGECOUNT) THEN
        SET V_CURRENTPAGE = V_PAGECOUNT;
    END IF;

    SET V_PAGEINDEX = V_CURRENTPAGE - 1;
    SET V_OFFSET = V_PAGEINDEX * P_PAGE_SIZE;

    
    SELECT 
        D.NCADE_ID,
        D.CCADE_CODIGO,
        D.CCADE_NOMBRE,
        D.CCADE_ABREVIATURA,
        E.NCATA_ID,
        E.CCATA_NOMBRE,
        IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS) AS FECHA_MODIFICACION,
        CONCAT(Y.NUSUA_ID, ' - ', X.CPERS_APE_PATERNO, ' ', X.CPERS_APE_MATERNO, ', ', X.CPERS_NOMBRES) AS USUARIO_RESPONSABLE,
        Z.CCADE_NOMBRE ESTADO_TEXTO,
        D.NCADE_ESTADO
    FROM dmforms.FRM_CATALOGO_DETALLE D
    INNER JOIN dmforms.FRM_CATALOGO E ON D.NCATA_ID = E.NCATA_ID AND E.NCATA_ESTADO = 1 AND E.NAUDI_EST_REG = 1
    LEFT JOIN dmforms.FRM_CATALOGO_DETALLE Z ON Z.NCATA_ID = 12 AND Z.CCADE_CODIGO = D.NCADE_ESTADO
    LEFT JOIN dmforms.FRM_USUARIO Y ON Y.NUSUA_ID = IFNULL(D.NAUDI_USR_UPD, D.NAUDI_USR_INS) AND Y.NUSUA_ESTADO = 1 AND Y.NAUDI_EST_REG = 1
    LEFT JOIN dmforms.FRM_PERSONA X ON X.NPERS_ID = Y.NPERS_ID AND X.NPERS_ESTADO = 1 AND X.NAUDI_EST_REG = 1
    WHERE (D.NCATA_ID = V_NCATA_ID OR V_NCATA_ID = -1)
      AND D.NAUDI_EST_REG = 1
      AND (D.NCADE_ESTADO = V_ESTADO OR V_ESTADO = -1)
      AND (CONCAT(D.CCADE_CODIGO, ' ', D.CCADE_NOMBRE) LIKE CONCAT('%', UPPER(V_CCADE_NOMBRE), '%'))
    ORDER BY 
        CASE WHEN V_ORDER = 'ASC' THEN
            CASE V_QUERY_ORDEN
                WHEN 'D.CCADE_CODIGO' THEN D.CCADE_CODIGO
                WHEN 'D.CCADE_ABREVIATURA' THEN D.CCADE_ABREVIATURA
                WHEN 'D.CCADE_NOMBRE' THEN D.CCADE_NOMBRE
                WHEN 'E.CCATA_NOMBRE' THEN E.CCATA_NOMBRE
                WHEN 'IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)' THEN IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)
                WHEN 'D.CAUDI_USR_INS' THEN D.NAUDI_USR_INS
                
                ELSE IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)
            END
        END ASC,
        CASE WHEN V_ORDER = 'DESC' THEN
            CASE V_QUERY_ORDEN
                WHEN 'D.CCADE_CODIGO' THEN D.CCADE_CODIGO
                WHEN 'D.CCADE_ABREVIATURA' THEN D.CCADE_ABREVIATURA
                WHEN 'D.CCADE_NOMBRE' THEN D.CCADE_NOMBRE
                WHEN 'E.CCATA_NOMBRE' THEN E.CCATA_NOMBRE
                WHEN 'IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)' THEN IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)
                WHEN 'D.CAUDI_USR_INS' THEN D.NAUDI_USR_INS
                
                ELSE IFNULL(D.DAUDI_USR_UPD, D.DAUDI_USR_INS)
            END
        END DESC
    LIMIT P_PAGE_SIZE OFFSET V_OFFSET;

    
    SELECT V_RECORDCOUNT AS RECORDCOUNT,
           V_PAGECOUNT AS PAGECOUNT,
           V_CURRENTPAGE AS CURRENTPAGE;
		
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_CATALOGO_DETALLE_LISTAR_POR_ID` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_CATALOGO_DETALLE_LISTAR_POR_ID`(
	IN P_NCATA_ID INT,
	IN P_NCADE_ID_ORIGEN INT
)
BEGIN
	
	SELECT D.NCADE_ID,
           D.CCADE_CODIGO,
           D.CCADE_NOMBRE,
           D.CCADE_DESCRIPCION,
           D.CCADE_ABREVIATURA,
           D.NCADE_ID_ORIGEN,
           D.NCADE_ORDENAMIENTO
    FROM dmforms.FRM_CATALOGO_DETALLE D
    WHERE D.NAUDI_EST_REG = 1
        AND NCADE_ESTADO = 1
        AND D.NCATA_ID = P_NCATA_ID
        AND (NCADE_ID_ORIGEN = P_NCADE_ID_ORIGEN OR IFNULL(P_NCADE_ID_ORIGEN, 0) = 0)
    ORDER BY D.NCADE_ORDENAMIENTO;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_DEPARTAMENTO_LISTAR_CMB` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_DEPARTAMENTO_LISTAR_CMB`(
	IN P_NDEPA_ESTADO INT
)
BEGIN
	
	SELECT
		NDEPA_ID,
		CDEPA_NOMBRE
	FROM dmbolsa.bt_departamento bd
	WHERE 
		(IFNULL(P_NDEPA_ESTADO, -1) = -1 OR BD.NDEPA_ESTADO = P_NDEPA_ESTADO)
		AND NAUDI_EST_REG = 1;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_DISTRITO_LISTAR_CMB` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_DISTRITO_LISTAR_CMB`(
	IN P_NDEPA_ID INT,
	IN P_NDIST_ESTADO INT
)
BEGIN
	DECLARE V_NDEPA_ID INT;

	SET V_NDEPA_ID = IFNULL(P_NDEPA_ID, 0);
	
	SELECT
		NDIST_ID,
		CDIST_NOMBRE
	FROM dmbolsa.bt_distrito bd
	WHERE BD.NDEPA_ID = V_NDEPA_ID
		AND (IFNULL(P_NDIST_ESTADO, -1) = -1 OR BD.NDIST_ESTADO = P_NDIST_ESTADO)
		AND NAUDI_EST_REG = 1;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_EVENTO_LISTAR_CMB` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_EVENTO_LISTAR_CMB`(
	IN P_NEVEN_ESTADO INT
)
BEGIN
	
	SELECT 
    	FE.NEVEN_ID,
      	FE.CEVEN_NOMBRE
    FROM dmforms.frm_eventos fe
    WHERE FE.NEVEN_ESTADO  = P_NEVEN_ESTADO OR IFNULL(P_NEVEN_ESTADO, '-1') = '-1'
    	AND FE.NAUDI_EST_REG = 1
    ORDER BY FE.CEVEN_NOMBRE;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_FORMULARIO_ENVIAR` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_FORMULARIO_ENVIAR`(
	IN P_RESPUESTA TEXT,
	IN P_CFORM_LINK VARCHAR(150)
)
BEGIN
	
	DECLARE V_NFORM_ID INT;
	DECLARE v_IdPregunta INT;
    DECLARE v_Respuesta TEXT;
   	DECLARE token_generado VARCHAR(150);
   	DECLARE v_Form_Resp INT;
    DECLARE v_Pos INT;
    DECLARE v_Temp TEXT;
   	DECLARE EXIT HANDLER FOR SQLEXCEPTION 
    BEGIN
        ROLLBACK; 
        RESIGNAL; 
        
        SELECT 0 AS NSUCCESS, 'Ha ocurrido un error al enviar el formulario' AS CMESSAGE;
       
    END;
       
    
    SET v_Temp = P_RESPUESTA;

    
    WHILE LENGTH(v_Temp) > 0 DO
        SET v_Pos = LOCATE(',', v_Temp);
        
        
        IF v_Pos > 0 THEN
            SET v_Respuesta = LEFT(v_Temp, v_Pos - 1);
            SET v_Temp = SUBSTRING(v_Temp, v_Pos + 1);
        ELSE
            SET v_Respuesta = v_Temp;
            SET v_Temp = '';
        END IF;
       
       	SELECT NFORM_ID INTO V_NFORM_ID FROM dmforms.frm_formularios ff 
       	WHERE ff.CFORM_LINK = P_CFORM_LINK;
       	
       	
       	INSERT INTO dmforms.frm_formularios_respuesta (NFORM_ID, NFORES_ESTADO_ENVIO)
    	VALUES (V_NFORM_ID, 1) ;
    
		SET @v_Form_Resp = LAST_INSERT_ID();
		SET @cadena_base = CONCAT(v_Form_Resp, '_', NOW());
		SET @token_generado = CONCAT('forms/', MD5(@cadena_base));
	
		UPDATE dmforms.frm_formularios_respuesta SET CFORES_LINK = token_generado 
		WHERE NFORES_ID = v_Form_Resp;
	
        
        SET v_Pos = LOCATE('|', v_Respuesta);
        IF v_Pos > 0 THEN
            SET v_IdPregunta = LEFT(v_Respuesta, v_Pos - 1);
            SET v_Respuesta = SUBSTRING(v_Respuesta, v_Pos + 1);

            
            INSERT INTO dmforms.frm_respuestas (NPREG_ID, CPREG_RESPUESTA, NFORES_ID)
            VALUES (v_IdPregunta, v_Respuesta, @v_Form_Resp);
        END IF;
    END WHILE;
	
   	
    COMMIT;
   
   	SELECT @v_Form_Resp AS NSUCCESS, 'Formulario enviado exitosamente' AS CMESSAGE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_FORMULARIO_OBTENER_DATOS` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_FORMULARIO_OBTENER_DATOS`(
	IN P_URL VARCHAR(250)
)
BEGIN
	
	
    DECLARE P_ID INT;
	DECLARE done INT DEFAULT FALSE;
    DECLARE V_NPREG_ID INT;
    DECLARE V_CPREG_ALTERNATIVAS TEXT;
    DECLARE V_ES_NUMERICO BOOLEAN;
    DECLARE curPreguntas CURSOR FOR
        SELECT NPREG_ID, CPREG_ALTERNATIVAS
        FROM dmforms.frm_preguntas
        WHERE NFORM_ID = P_ID
       		AND NAUDI_EST_REG = 1;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
	
   	SELECT NFORM_ID INTO P_ID FROM dmforms.frm_formularios ff WHERE FF.CFORM_LINK = P_URL;
   
	
	SELECT 
		FF.NFORM_ID, 
		FF.CFORM_TITULO,
		FF.CFORM_IMAGEN,
		FF.CFORM_SUBTITULO,
		FE.CEVEN_NOMBRE 
	FROM dmforms.frm_formularios FF
	INNER JOIN dmforms.frm_eventos FE ON FF.NEVEN_ID = FE.NEVEN_ID AND FE.NEVEN_ESTADO = 1 AND FE.NAUDI_EST_REG = 1
	WHERE FF.NFORM_ID = P_ID
		AND FF.NAUDI_EST_REG = 1;

	
	SELECT 
		ROW_NUMBER() OVER (ORDER BY NPREG_ORDENAMIENTO ASC) NUMERO,
		FP.NPREG_ID ,
		FP.NPREG_ORDENAMIENTO,
		FP.CPREG_DESCRIPCION,
		FP.CPREG_ALTERNATIVAS,
		FP.NPREG_OBLIGATORIO,
		FP.NPREG_ES_FECHA,
		FP.NPREG_ES_NUMERO,
		FP.NPREG_ES_CORREO,
		FP.NPREG_ES_REGEXP,
		FP.NCANT_ARCHIVOS,
		FP.NCADE_TIPO_PREG,
		FCD.CCADE_NOMBRE
	FROM dmforms.frm_preguntas FP
	INNER JOIN dmforms.frm_catalogo_detalle fcd ON FP.NCADE_TIPO_PREG = FCD.NCADE_ID AND FCD.NAUDI_EST_REG = 1 AND FCD.NCADE_ESTADO = 1
	WHERE FP.NFORM_ID = P_ID
		AND FP.NAUDI_EST_REG = 1;
	
	
	
    CREATE TEMPORARY TABLE TempAlternativas (
        NPREG_ID INT,
        DESCRIPCION VARCHAR(255)
    );

    
    OPEN curPreguntas;

    read_loop: LOOP
        FETCH curPreguntas INTO V_NPREG_ID, V_CPREG_ALTERNATIVAS;
        IF done THEN
            LEAVE read_loop;
        END IF;

        
        SET V_ES_NUMERICO = (V_CPREG_ALTERNATIVAS REGEXP '^[0-9]+$');

        IF V_ES_NUMERICO THEN
            
            INSERT INTO TempAlternativas (NPREG_ID, DESCRIPCION)
            SELECT V_NPREG_ID, CCADE_NOMBRE
            FROM dmforms.frm_catalogo_detalle
            WHERE NCATA_ID = CAST(V_CPREG_ALTERNATIVAS AS UNSIGNED)
              AND NAUDI_EST_REG = 1;
        ELSE
            
		    IF V_CPREG_ALTERNATIVAS LIKE '[%' AND V_CPREG_ALTERNATIVAS LIKE '%]' THEN
		        
		        SET V_CPREG_ALTERNATIVAS = SUBSTRING(V_CPREG_ALTERNATIVAS, 2, CHAR_LENGTH(V_CPREG_ALTERNATIVAS) - 2);
		        
		        
		        SET @alternativas = V_CPREG_ALTERNATIVAS;
		        WHILE CHAR_LENGTH(@alternativas) > 0 DO
		            SET @alternativa = TRIM(SUBSTRING_INDEX(@alternativas, ';', 1));
		            SET @alternativas = TRIM(SUBSTRING(@alternativas, CHAR_LENGTH(@alternativa) + 2));
		
		            
		            INSERT INTO TempAlternativas (NPREG_ID, DESCRIPCION)
		            VALUES (V_NPREG_ID, TRIM(@alternativa));
		        END WHILE;
		    
		    END IF;
        END IF;
    END LOOP;

    CLOSE curPreguntas;

    
    SELECT NPREG_ID, ROW_NUMBER() OVER () AS 'INDEX', DESCRIPCION FROM TempAlternativas;

    
    DROP TEMPORARY TABLE TempAlternativas;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_PUESTOS_CAMBIAR_ESTADO` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_PUESTOS_CAMBIAR_ESTADO`(
	IN P_NPUEST_ID INT,
	IN P_NAUDI_USR_UPD INT
)
BEGIN
	DECLARE V_ESTADO INT DEFAULT 0;
	DECLARE V_MENSAJE VARCHAR(1000) DEFAULT 'Ha sucedio un error en el registro';
    DECLARE V_RESULTADO INT DEFAULT 0;
	
	SELECT NPUEST_ESTADO INTO V_ESTADO 
	FROM dmbolsa.bt_puestos
	WHERE NPUEST_ID = P_NPUEST_ID;
	
	UPDATE dmbolsa.bt_puestos
	SET NPUEST_ESTADO = IF(V_ESTADO = 0, 1, 0),
		NAUDI_REG_UPD = P_NAUDI_USR_UPD,
		DAUDI_REG_UPD = NOW()
	WHERE NPUEST_ID = P_NPUEST_ID;
	
	IF ROW_COUNT() > 0 THEN
		SET V_RESULTADO = P_NPUEST_ID;
		SET V_MENSAJE = "Se ha actualido el estado exitosamente";
	ELSE
		SET V_RESULTADO = 0;
		SET V_MENSAJE = "No se ha podido actualizar el estado";
	END IF;
	
	COMMIT;
	SELECT V_RESULTADO NSUCCESS, V_MENSAJE CMESSAGE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_PUESTOS_ELIMINAR` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_PUESTOS_ELIMINAR`(
	IN P_NPUEST_ID INT,
	IN P_NAUDI_USR_UPD INT
)
BEGIN

	IF P_NPUEST_ID > 0 THEN 
      
      	UPDATE dmbolsa.bt_puestos 
      	SET NAUDI_EST_REG = 0, NAUDI_REG_UPD = P_NAUDI_USR_UPD, DAUDI_REG_UPD = NOW()
      	WHERE NPUEST_ID = P_NPUEST_ID;
      
      	-- Verificar si se actualizó algún registro
		IF ROW_COUNT() > 0 THEN
			SELECT 
				1 AS NSUCCESS, 
				'Se ha eliminado el registro' AS CMESSAGE;
		ELSE
			SELECT 
				0 AS NSUCCESS, 
				'No se ha podido eliminar el registro' AS CMESSAGE;
		END IF;
      
	ELSE 
		
		SELECT 
			2 NSUCCESS,
			'No existe un regitro para el ID';
	
	END IF;	
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_PUESTOS_INS_UPD` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_PUESTOS_INS_UPD`(
	IN P_NPUEST_ID INT,
	IN P_CPUEST_TITULO VARCHAR(150),
	IN P_CPUEST_DESCRIPCION TEXT,
	IN P_DPUEST_FECHA_INI DATE,
	IN P_DPUEST_FECHA_FIN DATE,
	IN P_NDIST_ID INT,
	IN P_NPUEST_ESTADO INT,
	IN P_NAUDI_USR_INS INT
)
BEGIN
	
	DECLARE V_NPUEST_ID INT;
	DECLARE V_EXISTE_TITULO VARCHAR(150);
	DECLARE V_EXISTE_ID INT;
	DECLARE V_MENSAJE VARCHAR(1000) DEFAULT 'Ha sucedio un error en el registro';
    DECLARE V_RESULTADO INT DEFAULT 0;
	
	SET V_NPUEST_ID = IFNULL(P_NPUEST_ID, 0);
	
	SELECT NPUEST_ID, CPUEST_TITULO INTO V_EXISTE_ID, V_EXISTE_TITULO
    FROM dmbolsa.bt_puestos
    WHERE UPPER(CPUEST_TITULO) = UPPER(P_CPUEST_TITULO)
    AND (V_NPUEST_ID = 0 OR NPUEST_ID != V_NPUEST_ID)
	LIMIT 1;
	
	IF V_EXISTE_ID IS NOT NULL THEN 
		SET V_MENSAJE = CONCAT('Ya existe una convocatoria con el título "', V_EXISTE_TITULO, '"');
        SET V_RESULTADO = 0;
	ELSE
		IF V_NPUEST_ID > 0 THEN
			-- ACTUALIZA
			UPDATE dmbolsa.BT_PUESTOS 
			SET CPUEST_TITULO = UPPER(P_CPUEST_TITULO),
				CPUEST_DESCRIPCION = P_CPUEST_DESCRIPCION,
				DPUEST_FECHA_INI = P_DPUEST_FECHA_INI,
				DPUEST_FECHA_FIN = P_DPUEST_FECHA_FIN,
				NDIST_ID = P_NDIST_ID,
				NPUEST_ESTADO = P_NPUEST_ESTADO,
				NAUDI_REG_UPD = P_NAUDI_USR_INS,
				DAUDI_REG_UPD = NOW()
			WHERE NPUEST_ID = P_NPUEST_ID;
		
			SET V_RESULTADO = V_NPUEST_ID;
			SET V_MENSAJE = "Se ha actualizado el registro exitosamente";
		ELSE
			-- INSERTAR
			INSERT INTO dmbolsa.BT_PUESTOS (
				CPUEST_TITULO,
				CPUEST_DESCRIPCION,
				DPUEST_FECHA_INI,
				DPUEST_FECHA_FIN,
				NDIST_ID,
				NAUDI_REG_INS
			) 
			VALUES (
				UPPER(P_CPUEST_TITULO),
				P_CPUEST_DESCRIPCION,
				P_DPUEST_FECHA_INI,
				P_DPUEST_FECHA_FIN,
				P_NDIST_ID,
				P_NAUDI_USR_INS
			);
			
			SET V_RESULTADO = LAST_INSERT_ID();
			SET V_MENSAJE = "Se ha insertado el registro exitosamente";
		END IF;
	END IF;
			
	COMMIT;
	SELECT V_MENSAJE CMESSAGE, V_RESULTADO NSUCCESS;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_PUESTOS_LISTAR_PAGINADO` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_PUESTOS_LISTAR_PAGINADO`(
	IN P_DAUDI_USR_INS DATE,
    IN P_CPUEST_TITULO VARCHAR(255),
    IN P_UBICACION VARCHAR(255),
    IN P_NPUEST_ESTADO INT,
    IN P_PAGE_SIZE INT,
    IN P_PAGE_NUMBER INT,
    IN P_ORDER_BY VARCHAR(100),
    IN P_ORDER VARCHAR(100)
)
BEGIN
    DECLARE V_CURRENTPAGE INT;
    DECLARE V_RECORDCOUNT INT;
    DECLARE V_PAGECOUNT INT;
    DECLARE V_PAGEINDEX INT;
    DECLARE V_ORDER_BY VARCHAR(100);
    DECLARE V_ORDER VARCHAR(100);
    DECLARE V_QUERY_ORDEN VARCHAR(500);
    DECLARE V_OFFSET INT;
   
    SET V_ORDER_BY = IFNULL(P_ORDER_BY, '');
   	SET V_ORDER = IFNULL(P_ORDER, '');
    
    IF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(P_NPUEST_ESTADO, 0) <> 2 THEN
        SET V_QUERY_ORDEN = 'BP.DAUDI_USR_INS';
        SET V_ORDER = 'DESC';
    ELSEIF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(P_NPUEST_ESTADO, 0) = 2 THEN
        SET V_ORDER = 'DESC';
        SET V_QUERY_ORDEN = 'IFNULL(FF.DAUDI_USR_UPD, FF.DAUDI_USR_INS)';
    ELSEIF V_ORDER_BY = 'titulo' THEN
        SET V_QUERY_ORDEN = 'CONCAT(BD.CDIST_NOMBRE, ", ", BD2.CDEPA_NOMBRE)';
    ELSEIF V_ORDER_BY = 'fechafin' THEN
        SET V_QUERY_ORDEN = 'BP.DPUEST_FECHA_FIN';
 	ELSEIF V_ORDER_BY = 'fechainicio' THEN
        SET V_QUERY_ORDEN = 'BP.DPUEST_FECHA_INI';
    ELSEIF V_ORDER_BY = 'fechaCreacion' THEN
        SET V_QUERY_ORDEN = 'IFNULL(BP.DAUDI_REG_UPD, BP.DAUDI_REG_INS)';
    ELSEIF V_ORDER_BY = 'responsable' THEN
        SET V_QUERY_ORDEN = 'CONCAT(Y.NUSUA_ID, " - ", X.CPERS_APE_PATERNO, " ", X.CPERS_APE_MATERNO, ", ", X.CPERS_NOMBRES)';
    ELSEIF V_ORDER_BY = 'usuarioCreacion' THEN
        SET V_QUERY_ORDEN = 'BP.NAUDI_REG_INS';
    ELSEIF V_ORDER_BY = 'estado' THEN
        SET V_QUERY_ORDEN = 'Z.CCADE_NOMBRE';
    ELSE
        SET V_QUERY_ORDEN = 'IFNULL(FF.DAUDI_REG_UPD, FF.DAUDI_REG_INS)';
    END IF;

    SELECT 
		COUNT(1)
	INTO V_RECORDCOUNT
	FROM dmbolsa.bt_puestos bp
	INNER JOIN dmbolsa.bt_distrito bd ON BP.NDIST_ID = BD.NDIST_ID AND BD.NDIST_ESTADO = 1 AND BD.NAUDI_EST_REG = 1
	INNER JOIN dmbolsa.bt_departamento bd2 ON BD2.NDEPA_ID = BD.NDEPA_ID AND BD2.NDEPA_ESTADO = 1 AND BD2.NAUDI_EST_REG = 1
	WHERE
		BP.CPUEST_TITULO LIKE CONCAT('%', UPPER(TRIM(IFNULL(P_CPUEST_TITULO, ''))), '%')
		AND CONCAT(BD.CDIST_NOMBRE, ', ', BD2.CDEPA_NOMBRE) LIKE '%%' 
		AND (IFNULL(P_NPUEST_ESTADO, -1) = -1 OR BP.NPUEST_ESTADO = P_NPUEST_ESTADO)
    	AND (IFNULL(P_DAUDI_USR_INS, -1) = -1 OR IFNULL(DATE(BP.DAUDI_REG_UPD), DATE(BP.DAUDI_REG_INS)) = P_DAUDI_USR_INS)
    	AND bd.NAUDI_EST_REG = 1;

    SET V_CURRENTPAGE = P_PAGE_NUMBER;
    SET V_PAGECOUNT = CEIL(V_RECORDCOUNT / P_PAGE_SIZE);

    IF (V_CURRENTPAGE > V_PAGECOUNT) THEN
        SET V_CURRENTPAGE = V_PAGECOUNT;
    END IF;

    SET V_PAGEINDEX = V_CURRENTPAGE - 1;
    SET V_OFFSET = V_PAGEINDEX * P_PAGE_SIZE;

    
    SELECT 
		BP.NPUEST_ID,
		BP.CPUEST_TITULO,
		BP.CPUEST_DESCRIPCION,
		BP.DPUEST_FECHA_INI,
		BP.DPUEST_FECHA_FIN,
		CONCAT(BD.CDIST_NOMBRE, ', ', BD2.CDEPA_NOMBRE) UBICACION,
		BP.NPUEST_ESTADO,
		IFNULL(BD.DAUDI_REG_UPD, BD.DAUDI_REG_INS) AS FECHA_MODIFICACION,
        CONCAT(Y.NUSUA_ID, ' - ', X.CPERS_APE_PATERNO, ' ', X.CPERS_APE_MATERNO, ', ', X.CPERS_NOMBRES) AS USUARIO_RESPONSABLE,
        Z.CCADE_NOMBRE ESTADO_TEXTO
	FROM dmbolsa.bt_puestos bp
	LEFT JOIN dmbolsa.BT_CATALOGO_DETALLE Z ON Z.NCATA_ID = 12 AND Z.CCADE_CODIGO = BP.NPUEST_ESTADO
    LEFT JOIN dmbolsa.BT_USUARIO Y ON Y.NUSUA_ID = IFNULL(BP.NAUDI_REG_UPD, BP.NAUDI_REG_INS) AND Y.NUSUA_ESTADO = 1 AND Y.NAUDI_EST_REG = 1
    LEFT JOIN dmbolsa.BT_PERSONA X ON X.NPERS_ID = Y.NPERS_ID AND X.NPERS_ESTADO = 1 AND X.NAUDI_EST_REG = 1
	INNER JOIN dmbolsa.bt_distrito bd ON BP.NDIST_ID = BD.NDIST_ID AND BD.NDIST_ESTADO = 1 AND BD.NAUDI_EST_REG = 1
	INNER JOIN dmbolsa.bt_departamento bd2 ON BD2.NDEPA_ID = BD.NDEPA_ID AND BD2.NDEPA_ESTADO = 1 AND BD2.NAUDI_EST_REG = 1
	WHERE
		CONCAT(BD.CDIST_NOMBRE, ', ', BD2.CDEPA_NOMBRE) LIKE '%%' AND BP.CPUEST_TITULO LIKE CONCAT('%', UPPER(TRIM(IFNULL(P_CPUEST_TITULO, ''))), '%')
		AND (IFNULL(P_NPUEST_ESTADO, -1) = -1 OR BP.NPUEST_ESTADO = P_NPUEST_ESTADO)
		AND (IFNULL(P_DAUDI_USR_INS, -1) = -1 OR IFNULL(DATE(BP.DAUDI_REG_UPD), DATE(BP.DAUDI_REG_INS)) = P_DAUDI_USR_INS)
		AND BP.NAUDI_EST_REG = 1 
	ORDER BY 
        CASE WHEN V_ORDER = 'ASC' THEN
            CASE V_QUERY_ORDEN
                WHEN 'BP.CPUEST_TITULO' THEN BP.CPUEST_TITULO 
                ELSE IFNULL(BP.DAUDI_REG_UPD, BP.DAUDI_REG_INS)
            END
        END ASC,
        CASE WHEN V_ORDER = 'DESC' THEN
            CASE V_QUERY_ORDEN
                WHEN 'BP.CPUEST_TITULO' THEN BP.CPUEST_TITULO
                ELSE IFNULL(BP.DAUDI_REG_UPD, BP.DAUDI_REG_INS)
            END
        END DESC 
    LIMIT P_PAGE_SIZE OFFSET V_OFFSET;

    
    SELECT V_RECORDCOUNT AS RECORDCOUNT,
           V_PAGECOUNT AS PAGECOUNT,
           V_CURRENTPAGE AS CURRENTPAGE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_PUESTOS_OBTENER_POR_ID` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_PUESTOS_OBTENER_POR_ID`(
	IN P_NPUEST_ID INT
)
BEGIN
	
	SELECT 
  		FP.NPUEST_ID,
  		FP.CPUEST_TITULO,
  		FP.CPUEST_DESCRIPCION,
  		FP.DPUEST_FECHA_INI,
  		FP.DPUEST_FECHA_FIN,
  		BD.CDIST_NOMBRE,
  		BD2.CDEPA_NOMBRE,
  		BD.NDIST_ID,
  		BD2.NDEPA_ID,
  		FP.CPUEST_IMAGEN,
  		FP.NPUEST_ESTADO
  	FROM dmbolsa.bt_puestos FP 
  	INNER JOIN dmbolsa.bt_distrito BD ON BD.NDIST_ID = FP.NDIST_ID AND BD.NDIST_ESTADO = 1 AND BD.NAUDI_EST_REG = 1
  	INNER JOIN dmbolsa.bt_departamento BD2 ON BD2.NDEPA_ID = BD.NDEPA_ID AND BD2.NDEPA_ESTADO = 1 AND BD2.NAUDI_EST_REG = 1
  	WHERE 
      	FP.NPUEST_ID = P_NPUEST_ID
      	AND FP.NAUDI_EST_REG = 1 AND FP.NPUEST_ESTADO = 1;	
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_PUESTOS_POSTULANTES_LISTAR_PAGINADO` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_PUESTOS_POSTULANTES_LISTAR_PAGINADO`(
	IN P_CPOST_NUMDOC VARCHAR(255),
    IN P_NOMBRES VARCHAR(255),
    IN P_NPUEST_ID INT,
    IN P_NUARO_ESTADO INT,
    IN P_PAGE_SIZE INT,
    IN P_PAGE_NUMBER INT,
    IN P_ORDER_BY VARCHAR(100),
    IN P_ORDER VARCHAR(100)
)
BEGIN
	DECLARE V_CURRENTPAGE INT;
    DECLARE V_RECORDCOUNT INT;
    DECLARE V_PAGECOUNT INT;
    DECLARE V_PAGEINDEX INT;
    DECLARE V_ORDER_BY VARCHAR(100);
    DECLARE V_ORDER VARCHAR(100);
    DECLARE V_QUERY_ORDEN VARCHAR(500);
    DECLARE V_OFFSET INT;
   
    SET V_ORDER_BY = IFNULL(P_ORDER_BY, '');
   	SET V_ORDER = IFNULL(P_ORDER, '');
    
    IF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(P_NUARO_ESTADO, 0) <> 2 THEN
        SET V_QUERY_ORDEN = 'BP.DAUDI_USR_INS';
        SET V_ORDER = 'DESC';
    ELSEIF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(P_NUARO_ESTADO, 0) = 2 THEN
        SET V_ORDER = 'DESC';
        SET V_QUERY_ORDEN = 'IFNULL(FF.DAUDI_USR_UPD, FF.DAUDI_USR_INS)';
    ELSEIF V_ORDER_BY = 'nombre' THEN
        SET V_QUERY_ORDEN = 'CONCAT(bp.CPOST_NOMBRES, " ", bp.CPOST_PATERNO, " ", bp.CPOST_MATERNO)';
    ELSEIF V_ORDER_BY = 'numdoc' THEN
        SET V_QUERY_ORDEN = 'IFNULL(bp.CPOST_NUMDOC, "")';
    ELSEIF V_ORDER_BY = 'fechaCreacion' THEN
        SET V_QUERY_ORDEN = 'IFNULL(BP.DAUDI_REG_UPD, BP.DAUDI_REG_INS)';
    ELSEIF V_ORDER_BY = 'responsable' THEN
        SET V_QUERY_ORDEN = 'CONCAT(Y.NUSUA_ID, " - ", X.CPERS_APE_PATERNO, " ", X.CPERS_APE_MATERNO, ", ", X.CPERS_NOMBRES)';
    ELSEIF V_ORDER_BY = 'usuarioCreacion' THEN
        SET V_QUERY_ORDEN = 'BP.NAUDI_REG_INS';
    ELSEIF V_ORDER_BY = 'estado' THEN
        SET V_QUERY_ORDEN = 'Z.CCADE_NOMBRE';
    ELSE
        SET V_QUERY_ORDEN = 'IFNULL(FF.DAUDI_REG_UPD, FF.DAUDI_REG_INS)';
    END IF;

    SELECT 
		COUNT(*)
	INTO V_RECORDCOUNT
	FROM dmbolsa.bt_postulaciones bp
	WHERE bp.NPUEST_ID = P_NPUEST_ID 
		AND CONCAT(bp.CPOST_NOMBRES, " ", bp.CPOST_PATERNO, " ", bp.CPOST_MATERNO) LIKE CONCAT('%', UPPER(TRIM(IFNULL(P_NOMBRES, ''))), '%')
		AND (IFNULL(bp.CPOST_NUMDOC, "") = "" OR bp.CPOST_NUMDOC = CPOST_NUMDOC)
		AND (IFNULL(P_NUARO_ESTADO, -1) = -1 OR BP.NUARO_ESTADO = P_NUARO_ESTADO);

    SET V_CURRENTPAGE = P_PAGE_NUMBER;
    SET V_PAGECOUNT = CEIL(V_RECORDCOUNT / P_PAGE_SIZE);

    IF (V_CURRENTPAGE > V_PAGECOUNT) THEN
        SET V_CURRENTPAGE = V_PAGECOUNT;
    END IF;

    SET V_PAGEINDEX = V_CURRENTPAGE - 1;
    SET V_OFFSET = V_PAGEINDEX * P_PAGE_SIZE;
    
    SELECT 
		BP.NPOST_ID,
		BP.CPOST_NUMDOC,
		CONCAT(bp.CPOST_NOMBRES, ' ', bp.CPOST_PATERNO, ' ', bp.CPOST_MATERNO) NOMBRES,
		BP.CPOST_CORREO,
		BP.CPOST_ARCHIVO,
		IFNULL(BP.DAUDI_REG_UPD, BP.DAUDI_REG_INS) AS FECHA_MODIFICACION,
        CONCAT(Y.NUSUA_ID, ' - ', X.CPERS_APE_PATERNO, ' ', X.CPERS_APE_MATERNO, ', ', X.CPERS_NOMBRES) AS USUARIO_RESPONSABLE,
        Z.CCADE_NOMBRE ESTADO_TEXTO
	FROM dmbolsa.bt_postulaciones bp
	LEFT JOIN dmbolsa.BT_CATALOGO_DETALLE Z ON Z.NCATA_ID = 12 AND Z.CCADE_CODIGO = BP.NUARO_ESTADO
    LEFT JOIN dmbolsa.BT_USUARIO Y ON Y.NUSUA_ID = IFNULL(BP.NAUDI_REG_UPD, BP.NAUDI_REG_INS) AND Y.NUSUA_ESTADO = 1 AND Y.NAUDI_EST_REG = 1
    LEFT JOIN dmbolsa.BT_PERSONA X ON X.NPERS_ID = Y.NPERS_ID AND X.NPERS_ESTADO = 1 AND X.NAUDI_EST_REG = 1
	WHERE bp.NPUEST_ID = P_NPUEST_ID 
		AND CONCAT(bp.CPOST_NOMBRES, ' ', bp.CPOST_MATERNO, ' ', bp.CPOST_MATERNO) LIKE CONCAT('%', UPPER(TRIM(IFNULL(P_NOMBRES, ''))), '%')
		AND (IFNULL(bp.CPOST_NUMDOC, '') = '' OR bp.CPOST_NUMDOC = CPOST_NUMDOC)
		AND (IFNULL(P_NUARO_ESTADO, -1) = -1 OR BP.NUARO_ESTADO = P_NUARO_ESTADO)
	ORDER BY 
        CASE WHEN V_ORDER = 'ASC' THEN
            CASE V_QUERY_ORDEN
                WHEN 'CONCAT(bp.CPOST_NOMBRES, ' ', bp.CPOST_MATERNO, ' ', bp.CPOST_MATERNO)' THEN CONCAT(bp.CPOST_NOMBRES, ' ', bp.CPOST_MATERNO, ' ', bp.CPOST_MATERNO) 
                ELSE IFNULL(BP.DAUDI_REG_UPD, BP.DAUDI_REG_INS)
            END
        END ASC,
        CASE WHEN V_ORDER = 'DESC' THEN
            CASE V_QUERY_ORDEN
                WHEN 'CONCAT(bp.CPOST_NOMBRES, ' ', bp.CPOST_MATERNO, ' ', bp.CPOST_MATERNO)' THEN CONCAT(bp.CPOST_NOMBRES, ' ', bp.CPOST_MATERNO, ' ', bp.CPOST_MATERNO)
                ELSE IFNULL(BP.DAUDI_REG_UPD, BP.DAUDI_REG_INS)
            END
        END DESC 
    LIMIT P_PAGE_SIZE OFFSET V_OFFSET;

    SELECT V_RECORDCOUNT AS RECORDCOUNT,
           V_PAGECOUNT AS PAGECOUNT,
           V_CURRENTPAGE AS CURRENTPAGE;
    
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_PUESTOS_POSTULAR` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_PUESTOS_POSTULAR`(
	IN P_NPOST_ID INT,
	IN P_NUSUA_ID INT,
	IN P_NCADE_TIPO_DOCUMENTO INT,
	IN P_CPOST_NUMDOC VARCHAR(100),
	IN P_CPOST_NOMBRES VARCHAR(100),
	IN P_CPOST_PATERNO VARCHAR(100),
	IN P_CPOST_MATERNO VARCHAR(100),
	IN P_CPOST_CORREO VARCHAR(100),
	IN P_CPOST_CELULAR VARCHAR(100),
	IN P_NPUEST_ID INT,
	IN P_CPOST_ARCHIVO VARCHAR(100)
)
BEGIN
	DECLARE V_EXISTE_CORREO INT DEFAULT 0;
	DECLARE V_EXISTE_DOCUMENTO INT DEFAULT 0;
	DECLARE V_MENSAJE VARCHAR(1000) DEFAULT 'Ha sucedio un error en el registro';
    DECLARE V_RESULTADO INT DEFAULT 0;

	-- VALIDACIONES
	IF P_NUSUA_ID = '' THEN 
		SET P_NUSUA_ID = NULL;
	END IF;
	
	IF P_NPOST_ID > 0 THEN
		-- ACTUALIZAR
		UPDATE dmbolsa.bt_postulaciones SET
			CPOST_NUMDOC = P_CPOST_NUMDOC, 
			NCADE_TIPO_DOCUMENTO = P_NCADE_TIPO_DOCUMENTO, 
			CPOST_NOMBRES = P_CPOST_NOMBRES, 
			CPOST_PATERNO = P_CPOST_PATERNO, 
			CPOST_MATERNO = P_CPOST_MATERNO, 
			NPUEST_ID = P_NPUEST_ID,
			CPOST_ARCHIVO = P_CPOST_ARCHIVO,
			CPOST_CORREO = P_CPOST_CORREO,
			CPOST_CELULAR = P_CPOST_CELULAR
		WHERE NPOST_ID = P_NPOST_ID;
	
		SET V_RESULTADO = P_NPOST_ID;
		SET V_MENSAJE = 'Actualización exitosa';
	ELSE
		-- INSERTAR
		SELECT COUNT(*) INTO V_EXISTE_CORREO FROM dmbolsa.bt_postulaciones bp 
		WHERE CPOST_CORREO = P_CPOST_CORREO AND NAUDI_EST_REG = 1;
		
		SELECT COUNT(*) INTO V_EXISTE_DOCUMENTO FROM dmbolsa.bt_postulaciones bp 
		WHERE CPOST_NUMDOC = P_CPOST_NUMDOC AND NAUDI_EST_REG = 1;
	
		IF V_EXISTE_CORREO = 0 THEN 
			IF V_EXISTE_DOCUMENTO = 0 THEN
				INSERT INTO 
					dmbolsa.bt_postulaciones (
						NUSUA_ID,
						NCADE_TIPO_DOCUMENTO,
						CPOST_NUMDOC,
						CPOST_NOMBRES, 
						CPOST_PATERNO, 
						CPOST_MATERNO, 
						NPUEST_ID,
						CPOST_ARCHIVO,
						CPOST_CORREO,
						CPOST_CELULAR
					)
				VALUES (
					P_NUSUA_ID,
					P_NCADE_TIPO_DOCUMENTO,
					P_CPOST_NUMDOC,
					P_CPOST_NOMBRES, 
					P_CPOST_PATERNO, 
					P_CPOST_MATERNO, 
					P_NPUEST_ID,
					P_CPOST_ARCHIVO,
					P_CPOST_CORREO,
					P_CPOST_CELULAR
				);
				SET V_RESULTADO = LAST_INSERT_ID();
				SET V_MENSAJE = 'Registro exitoso';
			ELSE
				SET V_RESULTADO = 0;
				SET V_MENSAJE = 'El número de documento ya se encuentra registrado';			
			END IF;
		ELSE
			SET V_RESULTADO = 0;
			SET V_MENSAJE = 'El correo ya se encuentra registrado';
		END IF;
	END IF;
	
	SELECT V_RESULTADO AS NSUCCESS, V_MENSAJE AS CMESSAGE;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_ROLES_LISTAR_CMB` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_ROLES_LISTAR_CMB`(
	IN P_NTIRO_ID INT
)
BEGIN
	
	SELECT 
      fr.NROLE_ID,
      fr.CROLE_NOMBRE
    FROM dmforms.FRM_ROLES fr
    INNER JOIN dmforms.FRM_TIPO_ROLES ftr ON fr.NTIRO_ID = ftr.NTIRO_ID AND ftr.NTIRO_ESTADO = 1 AND ftr.NAUDI_EST_REG = 1
    WHERE ftr.NTIRO_ID = P_NTIRO_ID
      AND fr.NROLE_ESTADO = 1 AND fr.NAUDI_EST_REG = 1
    ORDER BY fr.CROLE_NOMBRE;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_SEGURIDAD_CAMBIAR_PASSWORD` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_SEGURIDAD_CAMBIAR_PASSWORD`(
	IN P_NUSUA_ID INT,
	IN P_CUSUA_PASSWORD1 VARCHAR(150),
	IN P_CUSUA_PASSWORD2 VARCHAR(150)
)
BEGIN
	
    DECLARE V_TOKEN VARCHAR(255);

    
    IF P_CUSUA_PASSWORD1 <> P_CUSUA_PASSWORD2 THEN
		SELECT 
			2 AS NSUCCESS, 
			'La contraseña actual no coincide con la ingresada' AS CMESSAGE; 
    ELSE
        
        SET V_TOKEN = UUID(); 

        
        UPDATE dmforms.frm_usuario 
        SET 
            CUSUA_PASSWORD = P_CUSUA_PASSWORD2,
            CUSUA_TOKEN = V_TOKEN,
            DUSUA_TOKEN_VENC = NOW() + INTERVAL 1 DAY,
            DAUDI_REG_UPD = NOW(),
            NAUDI_REG_UPD = P_NUSUA_ID
        WHERE NUSUA_ID = P_NUSUA_ID;
		
       	
    	IF ROW_COUNT() > 0 THEN
			SELECT 
				1 AS NSUCCESS, 
				'Se ha actualizado la contraseña' AS CMESSAGE;
		ELSE
			SELECT 
				0 AS NSUCCESS, 
				'Se ha actualizado la contraseña' AS CMESSAGE;
    	END IF;
    
        
        COMMIT;

    END IF;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_SEGURIDAD_CAMBIAR_PASSWORD_NA` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_SEGURIDAD_CAMBIAR_PASSWORD_NA`(
	IN P_NUSUA_ID INT,
	IN P_CUSUA_PASSWORD1 VARCHAR(150),
	IN P_CUSUA_PASSWORD2 VARCHAR(150),
	IN P_CUSIA_TOKEN VARCHAR (200)
)
BEGIN
	DECLARE V_TOKEN VARCHAR(255);
	DECLARE V_VALIDO INT;
	
	
	SELECT COUNT(*)
    INTO V_VALIDO 
    FROM dmforms.frm_usuario fu  
    WHERE FU.NUSUA_ID = P_NUSUA_ID AND
      FU.CUSUA_TOKEN = P_CUSUA_TOKEN AND
      FU.DUSUA_TOKEN_VENC > SYSDATE;
     
	IF V_VALID > 0 THEN 
		
        
        SET V_TOKEN = UUID();
       
		UPDATE dmforms.frm_usuario  
      	SET CUSUA_PASSWORD = P_CUSUA_PASSWORD1, 
          	CUSUA_TOKEN = V_TOKEN, 
         	DUSUA_TOKEN_VENC = SYSDATE + INTERVAL '1' DAY,
	      	DAUDI_REG_UPD = SYSDATE,
	       	NAUDI_REG_UPD = P_NUSUA_ID
      	WHERE NUSUA_ID = P_NUSUA_ID;
      	
      	
		IF ROW_COUNT() > 0 THEN
			SELECT 
				1 AS NSUCCESS, 
				'Se ha actualizado la contraseña' AS CMESSAGE;
		ELSE
			SELECT 
				0 AS NSUCCESS, 
				'Se ha actualizado la contraseña' AS CMESSAGE;
		END IF;
	ELSE
		
		SELECT 
			2 AS NSUCCESS, 
			'El token no es válido' AS CMESSAGE;
	     
	END IF;

    
    COMMIT;
 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_SEGURIDAD_INGRESAR` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_SEGURIDAD_INGRESAR`(
	IN P_CUSUA_USERNAME VARCHAR(50),
    IN P_CUSUA_PASSWORD VARCHAR(150)
)
BEGIN

	
    SELECT 
        B.NUSUA_ID,
        A.CPERS_APE_PATERNO,
        A.CPERS_APE_MATERNO,
        A.CPERS_NOMBRES,
        A.CPERS_CORREO,
        (SELECT 
            RUAR.NROLE_ID 
         FROM dmforms.FRM_USUARIO_ASIG_ROLES RUAR 
         WHERE 
            RUAR.NUSUA_ID = B.NUSUA_ID AND 
            RUAR.NUARO_FLAG_PREDETERMINADO = 1 AND 
            RUAR.NAUDI_EST_REG = '1' AND 
            RUAR.NUARO_ESTADO = 1
         LIMIT 1) AS NROLE_ID
    FROM dmforms.FRM_PERSONA A
    INNER JOIN dmforms.FRM_USUARIO B ON A.NPERS_ID = B.NPERS_ID 
    WHERE 
        B.NUSUA_ESTADO = 1 AND 
        B.NAUDI_EST_REG = 1 AND 
        B.CUSUA_USERNAME = P_CUSUA_USERNAME AND 
        B.CUSUA_PASSWORD = P_CUSUA_PASSWORD AND 
        A.NPERS_ESTADO = 1 AND 
        A.NAUDI_EST_REG = 1;
       
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_USUARIO_ACTUALIZAR_DATOS` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_USUARIO_ACTUALIZAR_DATOS`(
	IN P_NUSUA_ID INT,
    IN P_NCADE_ID_TIPO_DOCUMENTO INT,
    IN P_NCADE_ID_SEXO INT,
    IN P_CPERS_NRO_DOCUMENTO VARCHAR(255),
    IN P_CPERS_NOMBRES VARCHAR(255),
    IN P_CPERS_APE_PATERNO VARCHAR(255),
    IN P_CPERS_APE_MATERNO VARCHAR(255),
    IN P_CPERS_CORREO VARCHAR(255),
    IN P_CPERS_TELEFONO VARCHAR(255),
    IN P_DPERS_FEC_NACIMIENTO DATE,
    IN P_CPERS_BIO TEXT 
)
BEGIN
	
	DECLARE V_NPERS_ID INT;

    
    SELECT NPERS_ID INTO V_NPERS_ID
    FROM dmforms.frm_usuario fu 
    WHERE NUSUA_ID = P_NUSUA_ID;

    
    UPDATE dmforms.frm_persona
    SET 
        NCADE_ID_TIPO_DOCUMENTO = P_NCADE_ID_TIPO_DOCUMENTO,
        NCADE_ID_SEXO = P_NCADE_ID_SEXO,
        CPERS_NRO_DOCUMENTO = P_CPERS_NRO_DOCUMENTO,
        CPERS_NOMBRES = P_CPERS_NOMBRES,
        CPERS_APE_PATERNO = P_CPERS_APE_PATERNO,
        CPERS_APE_MATERNO = P_CPERS_APE_MATERNO,
        CPERS_CORREO  = P_CPERS_CORREO,
        CPERS_TELEFONO = P_CPERS_TELEFONO,
        DPERS_FEC_NACIMIENTO = P_DPERS_FEC_NACIMIENTO,
        CPERS_BIO = P_CPERS_BIO
    WHERE NPERS_ID = V_NPERS_ID;

    
    IF ROW_COUNT() > 0 THEN
        SELECT 
       		1 AS NSUCCESS, 
       		'ACTUALIZACIÓN EXITOSA' AS CMESSAGE;
    ELSE
        SELECT 
       		0 AS NSUCCESS, 
       		'NO SE ENCONTRÓ NINGÚN REGISTRO PARA ACTUALIZAR' AS CMESSAGE;
    END IF;

    COMMIT;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_USUARIO_ASIG_ROLES_OBTENER_DATOS_POR_ROL` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_USUARIO_ASIG_ROLES_OBTENER_DATOS_POR_ROL`(
	IN P_NUARO_ID INT
)
BEGIN
	
	SELECT 
        fuar.NUARO_ID,
        fp.CPERS_APE_PATERNO, 
        fp.CPERS_APE_MATERNO,
        fp.CPERS_NOMBRES,
        fp.CPERS_CORREO ,
        fuar.NUARO_ESTADO,
        fu.CUSUA_USERNAME,
        fuar.NROLE_ID
      FROM dmbolsa.BT_USUARIO_ASIG_ROLES fuar
      INNER JOIN dmbolsa.BT_USUARIO fu ON fuar.NUSUA_ID = fu.NUSUA_ID AND fu.NUSUA_ESTADO = 1 AND fu.NAUDI_EST_REG = 1
      INNER JOIN dmbolsa.BT_PERSONA fp ON fu.NPERS_ID = fp.NPERS_ID AND fp.NPERS_ESTADO = 1 AND fp.NAUDI_EST_REG = 1
      WHERE FUAR.NUARO_ID = P_NUARO_ID
        AND fuar.NAUDI_EST_REG = 1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_USUARIO_CARGA_INICIAL` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_USUARIO_CARGA_INICIAL`(
	IN P_NUSUA_ID INT	
)
BEGIN
	
	DECLARE V_ROL_ID INT;

    
    SELECT RUR.NROLE_ID
    INTO V_ROL_ID
    FROM BT_USUARIO_ASIG_ROLES RUR
    WHERE RUR.NUSUA_ID = P_NUSUA_ID
        AND RUR.NAUDI_EST_REG = 1
        AND RUR.NUARO_ESTADO = 1
        AND RUR.NUARO_FLAG_PREDETERMINADO = 1;

    
    SELECT 
        U.NUSUA_ID,
        RR.CROLE_CODIGO,
        RUR.NROLE_ID
    FROM dmbolsa.BT_USUARIO U
    INNER JOIN dmbolsa.BT_USUARIO_ASIG_ROLES RUR 
        ON U.NUSUA_ID = RUR.NUSUA_ID 
        AND RUR.NAUDI_EST_REG = 1 
        AND RUR.NUARO_ESTADO = 1
    INNER JOIN dmbolsa.BT_ROLES RR 
        ON RR.NROLE_ID = RUR.NROLE_ID 
        AND RR.NROLE_ESTADO = 1 
        AND RR.NAUDI_EST_REG = 1
    WHERE U.NUSUA_ID = P_NUSUA_ID
        AND U.NAUDI_EST_REG = 1 
        AND U.NUSUA_ESTADO = 1;

    
    SELECT 
        E.NROLE_ID,
        E.CROLE_CODIGO,
        E.CROLE_NOMBRE
    FROM dmbolsa.BT_USUARIO_ASIG_ROLES RUAR
    INNER JOIN dmbolsa.BT_ROLES E 
        ON RUAR.NROLE_ID = E.NROLE_ID 
        AND E.NROLE_ESTADO = 1 
        AND E.NAUDI_EST_REG = 1
    WHERE RUAR.NUSUA_ID = P_NUSUA_ID
        AND RUAR.NAUDI_EST_REG = 1
        AND RUAR.NUARO_ESTADO = 1;

    
    SELECT 
        M.CMENU_ID,
        M.CMENU_NOMBRE,
        M.CMENU_ID_ORIGEN,
        M.NMENU_ORDENAMIENTO,
        M.CMENU_RUTA,
        M.CMENU_ICONO,
        RRM.NROME_VISIBLE
    FROM dmbolsa.BT_MENU M
    INNER JOIN dmbolsa.BT_MENU_ROLES RRM 
        ON M.CMENU_ID = RRM.CMENU_ID 
        AND RRM.NROME_ESTADO = 1 
        AND RRM.NAUDI_EST_REG = 1
    WHERE RRM.NROLE_ID = V_ROL_ID
        AND M.NAUDI_EST_REG = 1
        AND M.NMENU_ESTADO = 1
    ORDER BY M.NMENU_ORDENAMIENTO;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_USUARIO_CARGA_ROL_MENU` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_USUARIO_CARGA_ROL_MENU`(
	IN P_NUSUA_ID INT,
	IN P_NROLE_ID INT
)
BEGIN
	
	DECLARE V_ROL_ID INT;

    
    SELECT 
    	E.NROLE_ID,
     	E.CROLE_CODIGO,
     	E.CROLE_NOMBRE
  	FROM dmbolsa.BT_USUARIO_ASIG_ROLES RUAR
  	INNER JOIN dmbolsa.BT_ROLES E ON RUAR.NROLE_ID = E.NROLE_ID AND E.NROLE_ESTADO = 1 AND E.NAUDI_EST_REG = 1
  	WHERE RUAR.NUSUA_ID = P_NUSUA_ID
      	AND RUAR.NAUDI_EST_REG = 1
      	AND RUAR.NUARO_ESTADO = 1;

    
    SELECT 
    	M.CMENU_ID,
     	M.CMENU_NOMBRE,
     	M.CMENU_ID_ORIGEN,
     	M.NMENU_ORDENAMIENTO,
      	M.CMENU_RUTA,
      	M.CMENU_ICONO,
      	RRM.NROME_VISIBLE
 	FROM dmbolsa.BT_MENU M 
  	INNER JOIN dmbolsa.BT_MENU_ROLES RRM ON M.CMENU_ID = RRM.CMENU_ID AND RRM.NROME_ESTADO = 1 AND RRM.NAUDI_EST_REG =  1
   	WHERE RRM.NROLE_ID = P_NROLE_ID
      	AND M.NAUDI_EST_REG = 1
       	AND M.NMENU_ESTADO = 1
  	ORDER BY m.NMENU_ORDENAMIENTO;
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_USUARIO_ELIMINAR` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_USUARIO_ELIMINAR`(
	IN P_NUARO_ID INT,
	IN P_NAUDI_USR_UPD INT
)
BEGIN
	DECLARE V_NUSUA_ID INT;
	DECLARE V_NPERS_ID INT;

	IF P_NUARO_ID > 0 THEN 

		SELECT NUSUA_ID INTO V_NUSUA_ID FROM dmbolsa.BT_USUARIO_ASIG_ROLES WHERE NUARO_ID = P_NUARO_ID;
		SELECT NPERS_ID INTO V_NPERS_ID FROM dmbolsa.BT_USUARIO WHERE NUSUA_ID = V_NUSUA_ID;
      
      	UPDATE dmbolsa.BT_USUARIO_ASIG_ROLES 
      	SET NAUDI_EST_REG = 0, NAUDI_REG_UPD = P_NAUDI_USR_UPD, DAUDI_REG_UPD = NOW()
      	WHERE NUARO_ID = P_NUARO_ID;
		
      	/*
      	UPDATE dmforms.FRM_USUARIO
      	SET NAUDI_EST_REG = 0, NAUDI_REG_UPD = P_NAUDI_USR_UPD, DAUDI_REG_UPD = NOW()
      	WHERE NUSUA_ID = V_NUSUA_ID;

      	UPDATE dmforms.FRM_PERSONA
      	SET NAUDI_EST_REG = 0, NAUDI_REG_UPD = P_NAUDI_USR_UPD, DAUDI_REG_UPD = NOW()
      	WHERE NPERS_ID = V_NPERS_ID;
      	*/
      
      	-- Verificar si se actualizó algún registro
		IF ROW_COUNT() > 0 THEN
			SELECT 
				1 AS NSUCCESS, 
				'Se ha actualizado la contraseña' AS CMESSAGE;
		ELSE
			SELECT 
				0 AS NSUCCESS, 
				'No se ha actualizado la contraseña' AS CMESSAGE;
		END IF;
      
	ELSE 
		
		SELECT 
			2 NSUCCESS,
			'No existe un regitro para el ID se asignación';
	
	END IF;	
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_USUARIO_ENVIAR_RESTABLECIMIENTO` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_USUARIO_ENVIAR_RESTABLECIMIENTO`(
	IN P_CPERS_EMAIL VARCHAR(150),
	IN P_URL VARCHAR(150) 
)
BEGIN
	
	DECLARE V_NUSUA_ID INT DEFAULT 0;
    DECLARE V_CPERS_NOMBRES VARCHAR(400);
    DECLARE V_CPERS_EMAIL VARCHAR(400);
    DECLARE V_LINK VARCHAR(400);
    DECLARE V_TOKEN VARCHAR(160);
    DECLARE V_CONTENIDO_HTML TEXT;
    
    -- Variables para el cursor de salida simulado
    DECLARE ASUNTO VARCHAR(255);
    DECLARE EMAIL_DESTINO VARCHAR(400);
    DECLARE NOMBRE_DESTINO VARCHAR(400);
    DECLARE CONTENIDO_TEXTO TEXT;
    DECLARE CONTENIDO_HTML TEXT;
    DECLARE ESTADO INT DEFAULT 1;

    -- Control de errores
    DECLARE EXIT HANDLER FOR SQLEXCEPTION 
    BEGIN
        SELECT '' AS ASUNTO, '' AS EMAIL_DESTINO, '' AS NOMBRE_DESTINO, '' AS CONTENIDO_TEXTO, '' AS CONTENIDO_HTML, 0 AS ESTADO;
    END;

    -- Generar token aleatorio
    SET V_TOKEN = UPPER(SUBSTRING(MD5(RAND()), 1, 32));

    -- Obtener datos del usuario
    SELECT 
        U.NUSUA_ID,
        CONCAT(RP.CPERS_NOMBRES, ' ', RP.CPERS_APE_PATERNO, ' ', RP.CPERS_APE_MATERNO),
        SUBSTRING_INDEX(RP.CPERS_CORREO, '|', 1)
    INTO 
        V_NUSUA_ID,
        V_CPERS_NOMBRES,
        V_CPERS_EMAIL
    FROM dmbolsa.bt_USUARIO U
    INNER JOIN dmbolsa.bt_PERSONA RP ON U.NPERS_ID = RP.NPERS_ID
    WHERE RP.CPERS_CORREO = P_CPERS_EMAIL
      AND U.NAUDI_EST_REG = 1
    LIMIT 1;

    IF V_NUSUA_ID = 0 OR V_NUSUA_ID IS NULL THEN
        SELECT '' AS ASUNTO, '' AS EMAIL_DESTINO, '' AS NOMBRE_DESTINO, '' AS CONTENIDO_TEXTO, '' AS CONTENIDO_HTML, 0 AS ESTADO;
    ELSE
    	
    	-- Actualizar token
	    UPDATE dmbolsa.BT_USUARIO 
	    SET CUSUA_TOKEN = V_TOKEN, DUSUA_TOKEN_VENC = NOW() + INTERVAL 1 DAY
	    WHERE NUSUA_ID = V_NUSUA_ID;
	
	    -- Armar el link
	    SELECT CONCAT(P_URL, '/admin/reset-password?token=', CUSUA_TOKEN, '&id=', NUSUA_ID)
	    INTO V_LINK
	    FROM dmbolsa.BT_USUARIO 
	    WHERE NUSUA_ID = V_NUSUA_ID;
	
	    -- Contenido del correo (simplificado)
	    SET V_CONTENIDO_HTML = CONCAT(
	        '<p><table border="0" width="100%" cellspacing="0" cellpadding="30" bgcolor="#f7f7f7">',
	        '<tr><td><img src="https://www.derrama.org.pe/wp-content/themes/derrama//img/logo-derrama-magisterial-loader.svg" width="220" height="auto" /></td>',
	        '<td align="right">Derrama Magisterial</td></tr>',
	        '<tr><td colspan="2">',
	        '<p style="font-size: 13pt; font-family: Calibri,sans-serif;">Estimado(a) Sr(a): <strong>', V_CPERS_NOMBRES, '</strong></p>',
	        '<p style="text-align: justify; font-size: 11pt;">Se ha solicitado el restablecimiento de sus credenciales para acceder al sistema de aplicaciones de DM Desarrollo...</p>',
	        '<p style="text-align: justify; font-size: 11pt;">Haga click en el enlace para proceder con el cambio de su contraseña:</p>',
	        '<p style="text-align: justify; font-size: 11pt;">', V_LINK, '</p>',
	        '<p style="font-size: 10pt;">Gracias,<br>Derrama Magisterial</p>',
	        '<p style="font-size: 10pt;">Si no puede comunicarse envíe un correo a jguerreros@derrama.gob.pe.</p>',
	        '</td></tr></table></p>'
	    );
	
	    -- Simulación del REFCURSOR: solo retorna un SELECT
	    SELECT '[DM BOLSA DE TRABAJO] Restablecimiento de contraseña' AS ASUNTO,
	           V_CPERS_EMAIL AS EMAIL_DESTINO,
	           V_CPERS_NOMBRES AS NOMBRE_DESTINO,
	           '' AS CONTENIDO_TEXTO,
	           V_CONTENIDO_HTML AS CONTENIDO_HTML,
	           1 AS ESTADO;
    
    END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_USUARIO_INSERTAR` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_USUARIO_INSERTAR`(
	IN P_NUARO_ID INT,
    IN P_CUSUA_USERNAME VARCHAR(255),
	IN P_CPERS_NOMBRES VARCHAR(255),
    IN P_CPERS_APE_PATERNO VARCHAR(255),
    IN P_CPERS_APE_MATERNO VARCHAR(255),
    IN P_CPERS_CORREO VARCHAR(255), 
    IN P_NROLE_ID INT,
    IN P_NUARO_ESTADO INT,
    IN P_NAUDI_REG_INS INT 
)
BEGIN
	
 	DECLARE V_MENSAJE VARCHAR(1000) DEFAULT '';
    DECLARE V_NPERS_ID INT DEFAULT 0;
    DECLARE V_NUSUA_ID INT DEFAULT 0;
    DECLARE V_RESULTADO INT DEFAULT 0;
    DECLARE V_EXISTE_ROL INT DEFAULT 0;
    DECLARE V_EXISTE_USERNAME INT DEFAULT 0;
    DECLARE V_EXISTE_PERSONA INT DEFAULT 0;
    DECLARE V_TOKEN VARCHAR(255);
    
 	
 	START TRANSACTION;
	
 	SET V_TOKEN = UUID();
 	
 	IF P_NUARO_ID > 0 THEN
        SELECT NUSUA_ID INTO V_NUSUA_ID FROM dmbolsa.BT_USUARIO_ASIG_ROLES WHERE NUARO_ID = P_NUARO_ID;
        SELECT NPERS_ID INTO V_NPERS_ID FROM dmbolsa.BT_USUARIO WHERE NUSUA_ID = V_NUSUA_ID;

        SELECT COUNT(*) INTO V_EXISTE_ROL 
        FROM dmbolsa.BT_USUARIO_ASIG_ROLES
        WHERE NUARO_ID <> P_NUARO_ID AND NROLE_ID = P_NROLE_ID AND NUSUA_ID = V_NUSUA_ID;

        IF V_EXISTE_ROL > 0 THEN
            ROLLBACK;
            SET V_RESULTADO = 0;
            SET V_MENSAJE = 'El rol ingresado ya se encuentra registrado';
            SELECT V_MENSAJE AS CMESSAGE, V_RESULTADO AS NSUCCESS;
        ELSE
        	UPDATE dmbolsa.BT_USUARIO_ASIG_ROLES
	        SET NROLE_ID = P_NROLE_ID,
	            NUARO_ESTADO = P_NUARO_ESTADO,
	            NAUDI_REG_UPD = P_NAUDI_REG_INS,
	            DAUDI_REG_UPD = NOW()
	        WHERE NUARO_ID = P_NUARO_ID;
        END IF;

        SELECT COUNT(*) INTO V_EXISTE_USERNAME 
        FROM dmbolsa.BT_USUARIO
        WHERE NUSUA_ID <> V_NUSUA_ID AND CUSUA_USERNAME = P_CUSUA_USERNAME;

        IF V_EXISTE_USERNAME > 0 THEN
            ROLLBACK;
            SET V_RESULTADO = 0;
            SET V_MENSAJE = 'El username ingresado ya se encuentra registrado';
            SELECT V_MENSAJE AS CMESSAGE, V_RESULTADO AS NSUCCESS;
        ELSE
        	UPDATE dmbolsa.BT_USUARIO
	        SET CUSUA_USERNAME = P_CUSUA_USERNAME,
	            CUSUA_TOKEN = V_TOKEN,
	            DUSUA_TOKEN_VENC = NOW() + INTERVAL 1 DAY,
	            NAUDI_REG_UPD = P_NAUDI_REG_INS,
	            DAUDI_REG_UPD = NOW()
	        WHERE NUSUA_ID = V_NUSUA_ID;
        END IF;

        SELECT COUNT(*) INTO V_EXISTE_PERSONA 
        FROM dmbolsa.BT_PERSONA
        WHERE NPERS_ID <> V_NPERS_ID
        AND ((CPERS_NOMBRES = P_CPERS_NOMBRES AND CPERS_APE_PATERNO = P_CPERS_APE_PATERNO AND CPERS_APE_MATERNO = P_CPERS_APE_MATERNO)
             OR CPERS_CORREO = P_CPERS_CORREO);

        IF V_EXISTE_PERSONA > 0 THEN
            ROLLBACK;
            SET V_RESULTADO = 0;
            SET V_MENSAJE = 'Los datos de la persona ya existen';
            SELECT V_MENSAJE AS CMESSAGE, V_RESULTADO AS NSUCCESS;
		ELSE
			UPDATE dmbolsa.BT_PERSONA
	        SET CPERS_NOMBRES = P_CPERS_NOMBRES,
	            CPERS_APE_PATERNO = P_CPERS_APE_PATERNO,
	            CPERS_APE_MATERNO = P_CPERS_APE_MATERNO,
	            CPERS_CORREO = P_CPERS_CORREO,
	            NAUDI_REG_UPD = P_NAUDI_REG_INS,
	            DAUDI_REG_UPD = NOW()
	        WHERE NPERS_ID = V_NPERS_ID;
        END IF;

    ELSE
        -- INSERT NUEVO
        SELECT COUNT(*) INTO V_EXISTE_PERSONA 
        FROM dmbolsa.BT_PERSONA
        WHERE ((CPERS_NOMBRES = P_CPERS_NOMBRES AND CPERS_APE_PATERNO = P_CPERS_APE_PATERNO AND CPERS_APE_MATERNO = P_CPERS_APE_MATERNO)
              OR CPERS_CORREO = P_CPERS_CORREO);

        IF V_EXISTE_PERSONA > 0 THEN
            ROLLBACK;
            SET V_RESULTADO = 0;
            SET V_MENSAJE = 'Los datos de la persona ya existen';
            SELECT V_MENSAJE AS CMESSAGE, V_RESULTADO AS NSUCCESS;
        ELSE
        	INSERT INTO dmbolsa.BT_PERSONA (CPERS_NOMBRES, CPERS_APE_PATERNO, CPERS_APE_MATERNO, CPERS_CORREO, NAUDI_REG_INS, DAUDI_REG_INS)
	        VALUES (P_CPERS_NOMBRES, P_CPERS_APE_PATERNO, P_CPERS_APE_MATERNO, P_CPERS_CORREO, P_NAUDI_REG_INS, NOW());
	        SET V_NPERS_ID = LAST_INSERT_ID();
        END IF;

        SELECT COUNT(*) INTO V_EXISTE_USERNAME 
        FROM dmbolsa.BT_USUARIO
        WHERE CUSUA_USERNAME = P_CUSUA_USERNAME;

        IF V_EXISTE_USERNAME > 0 THEN
            ROLLBACK;
            SET V_RESULTADO = 0;
            SET V_MENSAJE = 'El usuario ingresado ya se encuentra registrado';
            SELECT V_MENSAJE AS CMESSAGE, V_RESULTADO AS NSUCCESS;
		ELSE
			INSERT INTO dmbolsa.BT_USUARIO (CUSUA_USERNAME, NPERS_ID, CUSUA_TOKEN, DUSUA_TOKEN_VENC, NAUDI_REG_INS, DAUDI_REG_INS)
	        VALUES (P_CUSUA_USERNAME, V_NPERS_ID, V_TOKEN, NOW() + INTERVAL 1 DAY, P_NAUDI_REG_INS, NOW());
	        SET V_NUSUA_ID = LAST_INSERT_ID();
        END IF;

        -- Verificar rol asignado
	    SELECT COUNT(*) INTO V_EXISTE_ROL FROM dmbolsa.BT_USUARIO_ASIG_ROLES
	    WHERE NUSUA_ID = V_NUSUA_ID AND NROLE_ID = P_NROLE_ID;
	
	    IF V_EXISTE_ROL > 0 THEN
	   		ROLLBACK;
	      	SET V_RESULTADO = 0;
	      	SET V_MENSAJE = 'El rol ingresado ya se encuentra registrado';
	    ELSE
	    	INSERT INTO dmbolsa.BT_USUARIO_ASIG_ROLES (NUSUA_ID, NROLE_ID, NUARO_ESTADO, NAUDI_REG_INS, DAUDI_REG_INS)
	        VALUES (V_NUSUA_ID, P_NROLE_ID, P_NUARO_ESTADO, P_NAUDI_REG_INS, NOW());
	    END IF;
    END IF;

    COMMIT;
    SET V_RESULTADO = 1;
    SET V_MENSAJE = 'Operación completada con éxito.';
    SELECT V_MENSAJE AS CMESSAGE, V_RESULTADO AS NSUCCESS;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_USUARIO_LISTAR` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_USUARIO_LISTAR`(
    IN P_NUARO_ESTADO INT,
    IN P_USUARIO VARCHAR(255),
    IN P_NTIRO_ID INT,
    IN P_NROLE_ID INT,
    IN P_CPERS_CORREO VARCHAR(255),
    IN P_NCADE_ID_SEXO INT,
    IN P_ORDER_BY VARCHAR(100),
    IN P_ORDER VARCHAR(100)
)
BEGIN
	DECLARE V_USUARIO VARCHAR(255);
	DECLARE V_CPERS_CORREO VARCHAR(255);
    DECLARE V_RECORDCOUNT INT;
    DECLARE V_ORDER_BY VARCHAR(100);
    DECLARE V_ORDER VARCHAR(100);
    DECLARE V_QUERY_ORDEN VARCHAR(500);
	
   	SET V_USUARIO = IFNULL(P_USUARIO, '');
   	SET V_CPERS_CORREO = IFNULL(P_CPERS_CORREO, '');
   
    
    SET V_ORDER_BY = IFNULL(P_ORDER_BY, '');
   	SET V_ORDER = IFNULL(P_ORDER, '');
	
    
    IF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(P_NUARO_ESTADO, 0) <> 2 THEN
        SET V_QUERY_ORDEN = 'UAR.DAUDI_REG_INS';
        SET V_ORDER = 'DESC';
    ELSEIF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(P_NUARO_ESTADO, 0) = 2 THEN
        SET V_ORDER = 'DESC';
        SET V_QUERY_ORDEN = 'IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS)';
    ELSEIF V_ORDER_BY = 'nombre' THEN
        SET V_QUERY_ORDEN = 'CONCAT(IFNULL(P.CPERS_NOMBRES, '' ''), '' '', IFNULL(P.CPERS_APE_PATERNO, '' ''), '' '', IFNULL(P.CPERS_APE_MATERNO, '' ''))';
    ELSEIF V_ORDER_BY = 'rol' THEN
        SET V_QUERY_ORDEN = 'R.CROLE_NOMBRE';
    ELSEIF V_ORDER_BY = 'fechaCreacion' THEN
        SET V_QUERY_ORDEN = 'IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS)';
    ELSEIF V_ORDER_BY = 'responsable' THEN
        SET V_QUERY_ORDEN = 'FA_OBT_USUARIO_POR_COD(IFNULL(UAR.NAUDI_USR_UPD, UAR.NAUDI_USR_INS))';
    ELSEIF V_ORDER_BY = 'usuarioCreacion' THEN
        SET V_QUERY_ORDEN = 'UAR.CAUDI_USR_INS';
    ELSEIF V_ORDER_BY = 'estado' THEN
        SET V_QUERY_ORDEN = 'FA_OBT_TEXTO_CAT(12, UAR.NUARO_ESTADO)';
    ELSE
        SET V_QUERY_ORDEN = 'IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS)';
    END IF;

    
    SELECT COUNT(1)
    INTO V_RECORDCOUNT
    FROM dmforms.FRM_USUARIO U
    INNER JOIN dmforms.FRM_PERSONA P ON U.NPERS_ID = P.NPERS_ID AND P.NPERS_ESTADO = 1 AND P.NAUDI_EST_REG = 1
    INNER JOIN dmforms.FRM_USUARIO_ASIG_ROLES UAR ON U.NUSUA_ID = UAR.NUSUA_ID AND UAR.NAUDI_EST_REG = 1
    INNER JOIN dmforms.FRM_ROLES R ON UAR.NROLE_ID = R.NROLE_ID AND R.NROLE_ESTADO = 1 AND R.NAUDI_EST_REG = 1
    WHERE U.NAUDI_EST_REG = 1 
        AND (P_NUARO_ESTADO = -1 OR UAR.NUARO_ESTADO = P_NUARO_ESTADO)
        AND (P_NTIRO_ID = -1 OR R.NTIRO_ID = P_NTIRO_ID)
        AND (P_NROLE_ID = -1 OR R.NROLE_ID = P_NROLE_ID)
        AND (P_NCADE_ID_SEXO = -1 OR P.NCADE_ID_SEXO = P_NCADE_ID_SEXO)
        AND (CONCAT(IFNULL(P.CPERS_NOMBRES, ''), ' ', IFNULL(P.CPERS_APE_PATERNO, ''), ' ', IFNULL(P.CPERS_APE_MATERNO, '')) LIKE CONCAT('%', UPPER(TRIM(V_USUARIO)), '%'))
        AND IFNULL(P.CPERS_CORREO, '') LIKE CONCAT('%', UPPER(TRIM(V_CPERS_CORREO)), '%');

    
    SELECT 
    	ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) NUMERO,
        UAR.NUARO_ID,
        U.NUSUA_ID,
        U.NUSUA_ESTADO,
        CONCAT(R.CROLE_CODIGO, ' - ', R.CROLE_NOMBRE) AS CROLE_NOMBRE,
        TR.CTIRO_DESCRIPCION,
        R.NROLE_ESTADO,
        UAR.NUARO_ESTADO,
        P.CPERS_NOMBRES,
        P.CPERS_APE_PATERNO,
        P.CPERS_APE_MATERNO,
        P.CPERS_CORREO,
        P.CPERS_AVATAR,
        UAR.DAUDI_REG_INS,
        IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS) AS DAUDI_REG_UPD,
        DATE_FORMAT(UAR.DAUDI_REG_INS, '%d/%m/%Y %h:%i %p') AS FECHA_CREACION_TEXT,
        DATE_FORMAT(IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS), '%d/%m/%Y %h:%i %p') AS FECHA_MODIFICACION_TEXT,
        CONCAT(Y.NUSUA_ID, ' - ', X.CPERS_APE_PATERNO, ' ', X.CPERS_APE_MATERNO, ', ', X.CPERS_NOMBRES) AS USUARIO_RESPONSABLE,
        Z.CCADE_NOMBRE ESTADO_TEXTO,
        V_RECORDCOUNT AS V_RECORDCOUNT
    FROM dmforms.FRM_USUARIO U
    INNER JOIN dmforms.FRM_PERSONA P ON U.NPERS_ID = P.NPERS_ID
    INNER JOIN dmforms.FRM_USUARIO_ASIG_ROLES UAR ON U.NUSUA_ID = UAR.NUSUA_ID
    INNER JOIN dmforms.FRM_ROLES R ON UAR.NROLE_ID = R.NROLE_ID
    INNER JOIN dmforms.FRM_TIPO_ROLES TR ON R.NTIRO_ID = TR.NTIRO_ID
    LEFT JOIN dmforms.FRM_CATALOGO_DETALLE Z ON Z.NCATA_ID = 12 AND Z.CCADE_CODIGO = U.NUSUA_ESTADO
    LEFT JOIN dmforms.FRM_USUARIO Y ON Y.NUSUA_ID = IFNULL(U.NAUDI_REG_UPD, U.NAUDI_REG_INS) AND Y.NUSUA_ESTADO = 1 AND Y.NAUDI_EST_REG = 1
    LEFT JOIN dmforms.FRM_PERSONA X ON X.NPERS_ID = Y.NPERS_ID AND X.NPERS_ESTADO = 1 AND X.NAUDI_EST_REG = 1
    WHERE U.NAUDI_EST_REG = 1
        AND UAR.NAUDI_EST_REG = 1
        AND (P_NUARO_ESTADO = -1 OR UAR.NUARO_ESTADO = P_NUARO_ESTADO)
        AND (P_NTIRO_ID = -1 OR R.NTIRO_ID = P_NTIRO_ID)
        AND (P_NROLE_ID = -1 OR R.NROLE_ID = P_NROLE_ID)
        AND (P_NCADE_ID_SEXO = -1 OR P.NCADE_ID_SEXO = P_NCADE_ID_SEXO)
        AND (CONCAT(IFNULL(P.CPERS_NOMBRES, ''), ' ', IFNULL(P.CPERS_APE_PATERNO, ''), ' ', IFNULL(P.CPERS_APE_MATERNO, '')) LIKE CONCAT('%', UPPER(TRIM(V_USUARIO)), '%'))
        AND IFNULL(P.CPERS_CORREO, '') LIKE CONCAT('%', UPPER(TRIM(V_CPERS_CORREO)), '%')
    ORDER BY 
        CASE WHEN V_ORDER = 'ASC' THEN
            CASE V_QUERY_ORDEN
                
                WHEN 'CONCAT(...)' THEN CONCAT(IFNULL(P.CPERS_NOMBRES, ''), ' ', IFNULL(P.CPERS_APE_PATERNO, ''), ' ', IFNULL(P.CPERS_APE_MATERNO, ''))
                ELSE IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS)
            END
        END ASC,
        CASE WHEN V_ORDER = 'DESC' THEN
            CASE V_QUERY_ORDEN
                
                WHEN 'CONCAT(...)' THEN CONCAT(IFNULL(P.CPERS_NOMBRES, ''), ' ', IFNULL(P.CPERS_APE_PATERNO, ''), ' ', IFNULL(P.CPERS_APE_MATERNO, ''))
                ELSE IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS)
            END
        END DESC;
       
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_USUARIO_LISTAR_PAGINADO` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_USUARIO_LISTAR_PAGINADO`(
    IN P_NUARO_ESTADO INT,
    IN P_USUARIO VARCHAR(255),
    IN P_NTIRO_ID INT,
    IN P_NROLE_ID INT,
    IN P_CPERS_CORREO VARCHAR(255),
    IN P_NCADE_ID_SEXO INT,
    IN P_PAGE_SIZE INT,
    IN P_PAGE_NUMBER INT,
    IN P_ORDER_BY VARCHAR(100),
    IN P_ORDER VARCHAR(100)
)
BEGIN
	DECLARE V_USUARIO VARCHAR(255);
	DECLARE V_CPERS_CORREO VARCHAR(255);
    DECLARE V_CURRENTPAGE INT;
    DECLARE V_RECORDCOUNT INT;
    DECLARE V_PAGECOUNT INT;
    DECLARE V_PAGEINDEX INT;
    DECLARE V_ORDER_BY VARCHAR(100);
    DECLARE V_ORDER VARCHAR(100);
    DECLARE V_QUERY_ORDEN VARCHAR(500);
    DECLARE V_OFFSET INT;
	
   	SET V_USUARIO = IFNULL(P_USUARIO, '');
   	SET V_CPERS_CORREO = IFNULL(P_CPERS_CORREO, '');
   
    SET V_ORDER_BY = IFNULL(P_ORDER_BY, '');
   	SET V_ORDER = IFNULL(P_ORDER, '');
	
    
    IF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(P_NUARO_ESTADO, 0) <> 2 THEN
        SET V_QUERY_ORDEN = 'UAR.DAUDI_REG_INS';
        SET V_ORDER = 'DESC';
    ELSEIF (V_ORDER_BY = '' OR V_ORDER_BY IS NULL) AND IFNULL(P_NUARO_ESTADO, 0) = 2 THEN
        SET V_ORDER = 'DESC';
        SET V_QUERY_ORDEN = 'IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS)';
    ELSEIF V_ORDER_BY = 'nombre' THEN
        SET V_QUERY_ORDEN = 'CONCAT(IFNULL(P.CPERS_NOMBRES, '' ''), '' '', IFNULL(P.CPERS_APE_PATERNO, '' ''), '' '', IFNULL(P.CPERS_APE_MATERNO, '' ''))';
    ELSEIF V_ORDER_BY = 'rol' THEN
        SET V_QUERY_ORDEN = 'R.CROLE_NOMBRE';
    ELSEIF V_ORDER_BY = 'fechaCreacion' THEN
        SET V_QUERY_ORDEN = 'IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS)';
    ELSEIF V_ORDER_BY = 'responsable' THEN
        SET V_QUERY_ORDEN = 'FA_OBT_USUARIO_POR_COD(IFNULL(UAR.NAUDI_USR_UPD, UAR.NAUDI_USR_INS))';
    ELSEIF V_ORDER_BY = 'usuarioCreacion' THEN
        SET V_QUERY_ORDEN = 'UAR.CAUDI_USR_INS';
    ELSEIF V_ORDER_BY = 'estado' THEN
        SET V_QUERY_ORDEN = 'FA_OBT_TEXTO_CAT(12, UAR.NUARO_ESTADO)';
    ELSE
        SET V_QUERY_ORDEN = 'IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS)';
    END IF;

    
    SELECT COUNT(1)
    INTO V_RECORDCOUNT
    FROM dmbolsa.BT_USUARIO U
    INNER JOIN dmbolsa.BT_PERSONA P ON U.NPERS_ID = P.NPERS_ID AND P.NPERS_ESTADO = 1 AND P.NAUDI_EST_REG = 1
    INNER JOIN dmbolsa.BT_USUARIO_ASIG_ROLES UAR ON U.NUSUA_ID = UAR.NUSUA_ID AND UAR.NAUDI_EST_REG = 1
    INNER JOIN dmbolsa.BT_ROLES R ON UAR.NROLE_ID = R.NROLE_ID AND R.NROLE_ESTADO = 1 AND R.NAUDI_EST_REG = 1
    WHERE U.NAUDI_EST_REG = 1 
        AND (P_NUARO_ESTADO = -1 OR UAR.NUARO_ESTADO = P_NUARO_ESTADO)
        AND (P_NTIRO_ID = -1 OR R.NTIRO_ID = P_NTIRO_ID)
        AND (P_NROLE_ID = -1 OR R.NROLE_ID = P_NROLE_ID)
        AND (P_NCADE_ID_SEXO = -1 OR P.NCADE_ID_SEXO = P_NCADE_ID_SEXO)
        AND (CONCAT(IFNULL(P.CPERS_NOMBRES, ''), ' ', IFNULL(P.CPERS_APE_PATERNO, ''), ' ', IFNULL(P.CPERS_APE_MATERNO, '')) LIKE CONCAT('%', UPPER(TRIM(V_USUARIO)), '%'))
        AND IFNULL(P.CPERS_CORREO, '') LIKE CONCAT('%', UPPER(TRIM(V_CPERS_CORREO)), '%');

    
    SET V_CURRENTPAGE = P_PAGE_NUMBER;
    SET V_PAGECOUNT = CEIL(V_RECORDCOUNT / P_PAGE_SIZE);

    IF (V_CURRENTPAGE > V_PAGECOUNT) THEN
        SET V_CURRENTPAGE = V_PAGECOUNT;
    END IF;

    SET V_PAGEINDEX = V_CURRENTPAGE - 1;
    SET V_OFFSET = V_PAGEINDEX * P_PAGE_SIZE;

    
    SELECT 
        UAR.NUARO_ID,
        U.NUSUA_ID,
        U.NUSUA_ESTADO,
        CONCAT(R.CROLE_CODIGO, ' - ', R.CROLE_NOMBRE) AS CROLE_NOMBRE,
        TR.CTIRO_DESCRIPCION,
        R.NROLE_ESTADO,
        UAR.NUARO_ESTADO,
        P.CPERS_NOMBRES,
        P.CPERS_APE_PATERNO,
        P.CPERS_APE_MATERNO,
        P.CPERS_CORREO,
        P.CPERS_AVATAR,
        UAR.DAUDI_REG_INS,
        IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS) AS DAUDI_REG_UPD,
        DATE_FORMAT(UAR.DAUDI_REG_INS, '%d/%m/%Y %h:%i %p') AS FECHA_CREACION_TEXT,
        DATE_FORMAT(IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS), '%d/%m/%Y %h:%i %p') AS FECHA_MODIFICACION_TEXT,
        CONCAT(Y.NUSUA_ID, ' - ', X.CPERS_APE_PATERNO, ' ', X.CPERS_APE_MATERNO, ', ', X.CPERS_NOMBRES) AS USUARIO_RESPONSABLE,
        Z.CCADE_NOMBRE ESTADO_TEXTO,
        V_RECORDCOUNT AS V_RECORDCOUNT
    FROM dmbolsa.BT_USUARIO U
    INNER JOIN dmbolsa.BT_PERSONA P ON U.NPERS_ID = P.NPERS_ID
    INNER JOIN dmbolsa.BT_USUARIO_ASIG_ROLES UAR ON U.NUSUA_ID = UAR.NUSUA_ID
    INNER JOIN dmbolsa.BT_ROLES R ON UAR.NROLE_ID = R.NROLE_ID
    INNER JOIN dmbolsa.BT_TIPO_ROLES TR ON R.NTIRO_ID = TR.NTIRO_ID
    LEFT JOIN dmbolsa.BT_CATALOGO_DETALLE Z ON Z.NCATA_ID = 12 AND Z.CCADE_CODIGO = U.NUSUA_ESTADO
    LEFT JOIN dmbolsa.BT_USUARIO Y ON Y.NUSUA_ID = IFNULL(U.NAUDI_REG_UPD, U.NAUDI_REG_INS) AND Y.NUSUA_ESTADO = 1 AND Y.NAUDI_EST_REG = 1
    LEFT JOIN dmbolsa.BT_PERSONA X ON X.NPERS_ID = Y.NPERS_ID AND X.NPERS_ESTADO = 1 AND X.NAUDI_EST_REG = 1
    WHERE U.NAUDI_EST_REG = 1
        AND UAR.NAUDI_EST_REG = 1
        AND (P_NUARO_ESTADO = -1 OR UAR.NUARO_ESTADO = P_NUARO_ESTADO)
        AND (P_NTIRO_ID = -1 OR R.NTIRO_ID = P_NTIRO_ID)
        AND (P_NROLE_ID = -1 OR R.NROLE_ID = P_NROLE_ID)
        AND (P_NCADE_ID_SEXO = -1 OR P.NCADE_ID_SEXO = P_NCADE_ID_SEXO)
        AND (CONCAT(IFNULL(P.CPERS_NOMBRES, ''), ' ', IFNULL(P.CPERS_APE_PATERNO, ''), ' ', IFNULL(P.CPERS_APE_MATERNO, '')) LIKE CONCAT('%', UPPER(TRIM(V_USUARIO)), '%'))
        AND IFNULL(P.CPERS_CORREO, '') LIKE CONCAT('%', UPPER(TRIM(V_CPERS_CORREO)), '%')
    ORDER BY 
        CASE WHEN V_ORDER = 'ASC' THEN
            CASE V_QUERY_ORDEN
                
                WHEN 'CONCAT(...)' THEN CONCAT(IFNULL(P.CPERS_NOMBRES, ''), ' ', IFNULL(P.CPERS_APE_PATERNO, ''), ' ', IFNULL(P.CPERS_APE_MATERNO, ''))
                ELSE IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS)
            END
        END ASC,
        CASE WHEN V_ORDER = 'DESC' THEN
            CASE V_QUERY_ORDEN
                
                WHEN 'CONCAT(...)' THEN CONCAT(IFNULL(P.CPERS_NOMBRES, ''), ' ', IFNULL(P.CPERS_APE_PATERNO, ''), ' ', IFNULL(P.CPERS_APE_MATERNO, ''))
                ELSE IFNULL(UAR.DAUDI_REG_UPD, UAR.DAUDI_REG_INS)
            END
        END DESC
    LIMIT P_PAGE_SIZE OFFSET V_OFFSET;

    
    SELECT V_RECORDCOUNT AS RECORDCOUNT,
           V_PAGECOUNT AS PAGECOUNT,
           V_CURRENTPAGE AS CURRENTPAGE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SP_USUARIO_OBTENER_DATOS` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_USUARIO_OBTENER_DATOS`(
	IN P_NUSUA_ID INT
)
BEGIN
	
	SELECT 
  		FU.NUSUA_ID,
  		FP.NCADE_ID_TIPO_DOCUMENTO,
  		FP.CPERS_NRO_DOCUMENTO,
  		FP.DPERS_FEC_NACIMIENTO,
      	FP.CPERS_APE_PATERNO,
      	FP.CPERS_APE_MATERNO,
      	FP.CPERS_TELEFONO,
      	FP.CPERS_BIO,
      	FP.CPERS_NOMBRES,
      	FP.CPERS_CORREO,
      	FP.NCADE_ID_SEXO
  	FROM dmforms.frm_persona fp
  	INNER JOIN dmforms.frm_usuario fu ON FU.NPERS_ID = FP.NPERS_ID AND FU.NUSUA_ESTADO = 1 AND FU.NAUDI_EST_REG = 1
  	WHERE 
      	FU.NUSUA_ID = P_NUSUA_ID
      	AND FP.NAUDI_EST_REG = 1 AND FP.NPERS_ESTADO = 1;	
	
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2025-05-13 17:37:32
